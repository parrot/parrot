{"version":1,"ops":[{"type":1,"author":{"id":"5c5a1437d57bc93e00fe40289d8c8a34b3bf11f0"},"timestamp":1343722871,"metadata":{"github-id":"MDU6SXNzdWU1OTM3OTI0","github-url":"https://github.com/parrot/parrot/issues/804","origin":"github"},"title":"NetBSD needs Parrot_get_cpu_type added to its misc.c","message":"In parrot 4.5.0, parrot proper grew Parrot_get_cpu_type() function in src/platform/generic/misc.c.\n\nBecause NetBSD has its own misc.c, thanks to the need to have a non-empty Parrot_platform_init_code()\nfunction on alpha, it then also needs to have its own Parrot_get_cpu_type() added.  At least that was the\nsimplest fix I could come up with.\n\nDiff:\n\n```\ndiff --git a/src/platform/netbsd/misc.c b/src/platform/netbsd/misc.c\nindex db249ba..c9b2e51 100644\n--- a/src/platform/netbsd/misc.c\n+++ b/src/platform/netbsd/misc.c\n@@ -22,6 +22,10 @@ Miscellaneous helper functions that are specific to NetBSD.\n\n #include \"parrot/parrot.h\"\n\n+#ifdef PARROT_HAS_HEADER_SYSUTSNAME\n+#  include \u003csys/utsname.h\u003e\n+#endif\n+\n /* HEADERIZER HFILE: none */\n\n /*\n@@ -53,6 +57,33 @@ Parrot_platform_init_code(void)\n\n /*\n\n+=item C\u003cSTRING *Parrot_get_cpu_type(Parrot_Interp)\u003e\n+\n+Fetch CPU type for non-win32 systems\n+For win32, look in platform/win32/misc.c\n+\n+=back\n+\n+=cut\n+\n+*/\n+\n+STRING *\n+Parrot_get_cpu_type(Parrot_Interp interp) {\n+    struct utsname uname_info;\n+    char  *proc_arch = \"\";\n+\n+#ifdef PARROT_HAS_HEADER_SYSUTSNAME\n+    uname(\u0026uname_info);\n+    proc_arch = uname_info.machine;\n+#endif\n+    return Parrot_str_new_init(interp, proc_arch, strlen(proc_arch),\n+            Parrot_ascii_encoding_ptr, 0);\n+\n+}\n+\n+/*\n+\n =back\n\n =cut\n```","files":null}]}