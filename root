{"version":1,"ops":[{"type":1,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1404669774,"metadata":{"github-id":"MDU6SXNzdWUzNzIyMzk5NQ==","github-url":"https://github.com/parrot/parrot/issues/1082","origin":"github"},"title":"Failing auto::alignof probe with darwin + missing PARROT_ALIGNOF_charptr'","message":"the probes auto::alignof and auto::expect fail with no,\ncausing a subsequent `./include/parrot/datatypes.h:156:50:` error: use of undeclared identifier 'PARROT_ALIGNOF_charptr'\n\nSee perl Configure.pl --verbose-step=auto::alignof,auto::expect\n\n```\n/usr/bin/clang -pipe -Os -fno-common -I/opt/local/include -no-cpp-precomp  -fstack-protector -I/opt/local/include -pipe -fno-common  -isystem /opt/local/include -DHASATTRIBUTE_CONST  -DHASATTRIBUTE_DEPRECATED  -DHASATTRIBUTE_MALLOC  -DHASATTRIBUTE_NONNULL  -DHASATTRIBUTE_NORETURN  -DHASATTRIBUTE_PURE  -DHASATTRIBUTE_UNUSED  -DHASATTRIBUTE_WARN_UNUSED_RESULT  -DHASATTRIBUTE_HOT  -DHASATTRIBUTE_COLD  -DHAS_GETTEXT -I/opt/local/lib/libffi-3.1/include  -DHAVE_LONG_DOUBLE_VARIANT=0 -I./include -I./include/pmc -x c++ -I./include -c test_72689.c\nc++ -undefined dynamic_lookup -L/opt/local/lib -L$(libdir)  test_72689.o  -o test_72689  -lm -lutil -lgmp -lreadline -lintl -lffi\nsh: libdir: command not found\nld: warning: path 'test_72689.o' following -L not a directory\n./test_72689\ndyld: lazy symbol binding failed: Symbol not found: _main\n  Referenced from: /usr/src/parrot/parrot-git/./test_72689\n  Expected in: flat namespace\n```\n\nwhich is caused by an unexpanded -L$(libdir) in linkflags\n\n```\n$ grep libdir config_lib.pir\n    set $P0[\"libdir\"], \"/usr/local/lib\"\n    set $P0[\"linkflags\"], \"-undefined dynamic_lookup -L/opt/local/lib -L$(libdir) \"\n```\n\nwhere the wrong '-L$(libdir)' was added by the new libffi-3.1 pkg-config.\nWe need to expand it there.","files":null}]}