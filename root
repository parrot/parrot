{"version":1,"ops":[{"type":1,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1349283950,"metadata":{"github-id":"MDU6SXNzdWU3MzI3OTI4","github-url":"https://github.com/parrot/parrot/issues/856","origin":"github"},"title":"threads: t/src/embed.t and t/src/extend.t: test failures on Darwin/Intel.","message":"This ticket documents test failures in the 'threads' branch when run on Darwin/Intel (in this case, x86_64).  They have previously been reported on the parrot-dev mailing list.  (See, e.g., http://lists.parrot.org/pipermail/parrot-dev/2012-September/007184.html.)\n\nPer request from dukeleto, I am creating a git issue ticket for this problem.\n\n```\n[parrot] 508 $ export DYLD_LIBRARY_PATH=/Users/jkeenan/gitwork/parrot/blib/lib/\n[parrot] 509 $ echo $DYLD_LIBRARY_PATH\n/Users/jkeenan/gitwork/parrot/blib/lib/\n[parrot] 510 $ prove -v t/src/embed.t t/src/extend.t \nt/src/embed.t ... \n1..13\nok 1 - Minimal embed, create multiple interps\nnot ok 2 - Minimal embed, create multiple interps without giving 1st interp to Parrot_interp_new \n\n#   Failed test 'Minimal embed, create multiple interps without giving 1st interp to Parrot_interp_new '\n#   at t/src/embed.t line 113.\n# Done\n# Really done\n# \nnot ok 3 - Parrot_compile_string populates the error string when an opcode is given improper arguments # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'Parrot_compile_string populates the error string when an opcode is given improper arguments'\n#   at t/src/embed.t line 151.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_3\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_3\n#   Expected in: flat namespace\n# \n# \nnot ok 4 - Parrot_compile_string populates the error string when given invalid language string # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'Parrot_compile_string populates the error string when given invalid language string'\n#   at t/src/embed.t line 174.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_4\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_4\n#   Expected in: flat namespace\n# \n# \nnot ok 5 - Parrot_compile_string populates the error string when there is an IMCC syntax error # TODO TT #1610 : does not properly catch IMCC errors\n\n#   Failed (TODO) test 'Parrot_compile_string populates the error string when there is an IMCC syntax error'\n#   at t/src/embed.t line 198.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_5\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_5\n#   Expected in: flat namespace\n# \n# \nnot ok 6 - Hello world from main # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'Hello world from main'\n#   at t/src/embed.t line 224.\n# Hello, parrot\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_6\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_6\n#   Expected in: flat namespace\n# \n# \nnot ok 7 - Hello world from a sub # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'Hello world from a sub'\n#   at t/src/embed.t line 259.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_7\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_7\n#   Expected in: flat namespace\n# \n# \nnot ok 8 - calling a sub with string argument and return a string # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'calling a sub with string argument and return a string'\n#   at t/src/embed.t line 311.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_8\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_8\n#   Expected in: flat namespace\n# \n# \nnot ok 9 - returning a Float PMC # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'returning a Float PMC'\n#   at t/src/embed.t line 370.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_9\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_9\n#   Expected in: flat namespace\n# \n# \nnot ok 10 - returning two Float PMCs in a ResizablePMCArray # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'returning two Float PMCs in a ResizablePMCArray'\n#   at t/src/embed.t line 425.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_10\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_10\n#   Expected in: flat namespace\n# \n# \nnot ok 11 - calling a sub with string argument and return a numeric # TODO Must explicitly set a PIR compreg\n#   Failed (TODO) test 'calling a sub with string argument and return a numeric'\n#   at t/src/embed.t line 485.\n# dyld: lazy symbol binding failed: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_11\n#   Expected in: flat namespace\n# \n# dyld: Symbol not found: _Parrot_new_string\n#   Referenced from: /Users/jkeenan/gitwork/parrot/./t/src/embed_11\n#   Expected in: flat namespace\n# \n# \n# 'cc -fno-common  -pipe -fstack-protector -I/usr/local/include -pipe -fno-common  -DHASATTRIBUTE_CONST  -DHASATTRIBUTE_DEPRECATED  -DHASATTRIBUTE_MALLOC  -DHASATTRIBUTE_NONNULL  -DHASATTRIBUTE_NORETURN  -DHASATTRIBUTE_PURE  -DHASATTRIBUTE_UNUSED  -DHASATTRIBUTE_WARN_UNUSED_RESULT  -g  -I./include -c -o t/src/embed_12.o t/src/embed_12.c' failed with exit code 1\n# Failed to build 't/src/embed_12.o': t/src/embed.t: In function ‘createstring’:\n# t/src/embed.t:62: warning: return makes pointer from integer without a cast\n# t/src/embed.t: In function ‘main’:\n# t/src/embed.t:579: warning: assignment makes pointer from integer without a cast\n# t/src/embed.t:582: warning: assignment makes pointer from integer without a cast\n# t/src/embed.t:586: error: ‘hellosub’ undeclared (first use in this function)\n# t/src/embed.t:586: error: (Each undeclared identifier is reported only once\n# t/src/embed.t:586: error: for each function it appears in.)\nnot ok 12 - Insert external sub in namespace # TODO Must explicitly set a PIR compreg\n\n#   Failed (TODO) test 'Insert external sub in namespace'\n#   at t/src/embed.t line 543.\nok 13 # skip TT #306; many symbols not exported, embedding parrot fails\n# Looks like you failed 1 test of 13.\nDubious, test returned 1 (wstat 256, 0x100)\nFailed 1/13 subtests \n    (less 1 skipped subtest: 11 okay)\nt/src/extend.t .. \n1..19\nok 1 - Parrot_PMC_null\nok 2 - Parrot_get_root_namespace/Parrot_(un)register_pmc\nok 3 - Parrot_fprintf\nok 4 - Parrot_printf/Parrot_eprintf with no interp\nok 5 - Parrot_new_string\nok 6 - Parrot_new_string/Parrot_(un)register_string\nok 7 - PMC_set/get_integer\nok 8 - PMC_set/get_integer_keyed_int\nok 9 - PMC_set/get_number\nok 10 - PMC_set/get_string\nok 11 - call a parrot sub\nok 12 - call a parrot sub using the unified interface\nok 13 - call a parrot sub and return an integer\nok 14 - call a parrot sub, catch exception\nok 15 # skip Outdated test with the old embed API [GH #829]\nok 16 # skip Outdated test with the old embed API [GH #829]\nok 17 - call multi sub from C - \\#41511\nok 18 - call multi sub from C - unified interface\nnot ok 19 - multiple Parrot_interp_new/Parrot_x_exit cycles\n\n#   Failed test 'multiple Parrot_interp_new/Parrot_x_exit cycles'\n#   at t/src/extend.t line 743.\n# Starting interp 1\n# Destroying interp 1\n# Starting interp 2\n# Destroying interp 2\n# \n# Looks like you failed 1 test of 19.\nDubious, test returned 1 (wstat 256, 0x100)\nFailed 1/19 subtests \n    (less 2 skipped subtests: 16 okay)\n\nTest Summary Report\n-------------------\nt/src/embed.t (Wstat: 256 Tests: 13 Failed: 1)\n  Failed test:  2\n  Non-zero exit status: 1\nt/src/extend.t (Wstat: 256 Tests: 19 Failed: 1)\n  Failed test:  19\n  Non-zero exit status: 1\nFiles=2, Tests=32,  7 wallclock secs ( 0.05 usr  0.01 sys +  2.79 cusr  1.15 csys =  4.00 CPU)\nResult: FAIL\n```\n\nThe same tests pass on the same platform in 'master'.  They also pass (for me, at least) on the 'threads' branch on the older Darwin/PPC.\n\nThank you very much.\nJim Keenan","files":null}]}