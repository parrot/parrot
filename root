{"version":1,"ops":[{"type":1,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1301792922,"metadata":{"github-id":"MDU6SXNzdWUyODQ4NDQ3","github-url":"https://github.com/parrot/parrot/issues/250","origin":"github"},"title":"Eliminate reliance during build on 'tempdir' in config settings","message":"This ticket addresses an issue which came to dominate discussion in TT #1544 and supersedes that ticket.\n\nAs noted by Benabik and Coke 12 months ago, the value for `tempdir` in ''config_lib.pir'' and ''lib/Parrot/Config/Generated.pm'' can be dramatically different on different OSes and on different versions on the same OS.  For example, on my older Mac OS X 10.4.11, the results are straightforward and very Unix-ish:\n\n```\n$ grep -n tempdir config_lib.pir lib/Parrot/Config/Generated.pm \nconfig_lib.pir:272:    set $P0[\"tempdir\"], \"/tmp\"\nlib/Parrot/Config/Generated.pm:371:  'tempdir' =\u003e '/tmp',\n```\n\nBut on later versions of Mac OS X, it can appear as something much more, errrm, clever:\n\n```\nset P0[\"tempdir\"], \"/var/folders/Bh/BhrBssnnHYqX6SDI8N3S1U+++TM/-Tmp-\"\n```\n\nAs Coke put it in TT #1544, it \"like it's intended to be a one-time use tempdir, not something that we can save and reuse elsewhere.\"  Benabik speculated that \"I'm guessing ''launchd'' creates a new per-user temp dir at login. The problem here is that we're caching `TMPDIR` and there's no guarantee that it will be stable.'' \n\nIn each case, `tempdir` is simply picked up from Perl 5 early in the configuration process:\n\n```\n$ grep -n tempdir config/init/defaults.pm\n255:        tempdir =\u003e File::Spec-\u003etmpdir,\n```\n\nNo magic there, but it suggests that it is the '''environment''' in which Perl 5 is built on different OS versions that controls what Perl 5 gets and what, in turn, Parrot gets.\n\nTwo courses of action are conceivable:  One is to find some clever, Parrot-specific way of populating `tempdir`.  The other is simply to extirpate any instance where `tempdir` is used in our build or test systems.\n\nA bit of data on the latter option:  Here are the locations in our source code where I can see something what the problem is:\n\n```\n$ find . -type f | xargs grep -n 'config.*tempdir'\n./runtime/parrot/library/ProfTest/PIRProfile.nqp:66:\n    my $tmp_pir   := %config\u003ctempdir\u003e ~ %config\u003cslash\u003e ~ 'test.pir';\n./runtime/parrot/library/ProfTest/PIRProfile.nqp:67:\n    my $tmp_pprof := %config\u003ctempdir\u003e ~ %config\u003cslash\u003e ~ 'test.pprof';\n```\n\nAnother datum:  We have functions `tempdir()` and `tmpdir()` in '' ./runtime/parrot/library/osutils.pir''.  Would they be of any use?\n\nThank you very much.\n\nkid51\n\nOriginally http://trac.parrot.org/parrot/ticket/2085","files":null}]}