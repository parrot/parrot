{"version":1,"ops":[{"type":1,"author":{"id":"aa8915ba52969f979af836ca4704fd27e613004f"},"timestamp":1268767693,"metadata":{"github-id":"MDU6SXNzdWUyODQ4ODcx","github-url":"https://github.com/parrot/parrot/issues/662","origin":"github"},"title":"NQP-rx generates bad access code for non-twigiled attribute","message":"This code, with twigil:\n\n```\naustin@andLinux:~/kakapo$ cat test.nqp\nmethod foo() {\n    has @!attr;\n\n    for my @a {\n        say(@!attr);\n    }\n}\n```\n\nGenerates this pir:\n\n```\n.annotate \"line\", 5\n    find_lex $P24, \"self\"\n    getattribute $P25, $P24, \"@!attr\"\n    unless_null $P25, vivify_14\n    new $P25, \"ResizablePMCArray\"\n  vivify_14:\n```\n\nWhereas this code, sans twigil:\n\n```\naustin@andLinux:~/kakapo$ cat test.nqp\nmethod foo() {\n    has @attr;\n\n    for my @a {\n        say(@attr);\n    }\n}\n```\n\nGenerates this output:\n\n```\n.annotate \"line\", 5\n    getattribute $P24, self, \"@attr\"\n    $P25 = \"say\"($P24)\n.annotate \"line\", 4\n```\n\nBecause the sub is a nested block, it has no method declaration and so must do a find-lex lookup to get 'self'. This is not happening.\n\nSince the grammar does not support '.' as a twigil, which I think it should, I'm not sure if an attribute with no twigil is or isn't valid. If it's not valid, then the `has @attr` declaration should throw an error. If it's valid, then the access code should work.\n\nOriginally http://trac.parrot.org/parrot/ticket/1512","files":null}]}