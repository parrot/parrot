{"version":1,"ops":[{"type":1,"author":{"id":"5c5a1437d57bc93e00fe40289d8c8a34b3bf11f0"},"timestamp":1343721742,"metadata":{"github-id":"MDU6SXNzdWU1OTM3NjYx","github-url":"https://github.com/parrot/parrot/issues/803","origin":"github"},"title":"Installed executables contain rpath references to build directory","message":"This appears to be a variant over the theme from issue #201, only this variant is a little more serious.\nThe pkgsrc build framework has a test for this, and it started to trigger with Parrot 4.5.0.\n\nI think I've found a fix for the issue, and the fix is \"do not use the rpath_blib config variable\nwhen building installable executables; use only rpath_lib instead\".\n\nThis is formulated as a diff:\n\n```\n diff --git a/tools/dev/pbc_to_exe.winxed b/tools/dev/pbc_to_exe.winxed\nindex 89f3b1f..cd1bf67 100644\n--- a/tools/dev/pbc_to_exe.winxed\n+++ b/tools/dev/pbc_to_exe.winxed\n@@ -599,9 +599,9 @@ function link_file(string objfile, string exefile, string ex\n     string libparrot    = $P0['libparrot_linkflags'];\n     string libs         = $P0['libs'];\n     string o            = $P0['o'];\n-    string rpath        = $P0['rpath_blib'];\n     string osname       = $P0['osname'];\n     string build_dir    = $P0['build_dir'];\n+    string rpath        = '';\n     string slash        = $P0['slash'];\n     string icushared    = $P0['icu_shared'];\n     string installed    = $P0['installed'];\n@@ -613,9 +613,10 @@ function link_file(string objfile, string exefile, string e\n     string config     = pathquote;\n     if (installed != '1') {\n         config += build_dir + slash + 'src' + slash;\n-       if (! install)\n+       if (! install) {\n             config += 'parrot_config';\n-        else {\n+           rpath  += $P0['rpath_blib'];\n+        } else {\n             config += 'install_config';\n             rpath  += $P0['rpath_lib'];\n         }\n```","files":null}]}