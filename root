{"version":1,"ops":[{"type":1,"author":{"id":"5c5a1437d57bc93e00fe40289d8c8a34b3bf11f0"},"timestamp":1328780674,"metadata":{"github-id":"MDU6SXNzdWUzMTU0NTA4","github-url":"https://github.com/parrot/parrot/issues/714","origin":"github"},"title":"Use of usleep in conflict with SUSv2 (fencepost error)","message":"SUSv2 says in http://pubs.opengroup.org/onlinepubs/7908799/xsh/usleep.html:\n\nThe useconds argument must be less than 1,000,000.\nThe NetBSD libc implementation enforces this limitation.\n\nHowever, parrot will try to use that exact value, due to a fencepost error,\nand this causes several of the timer tests to fail.\n\nFix for parrot 3.9.0:\n\n--- src/scheduler.c.orig        2011-10-18 22:44:11.000000000 +0000\n+++ src/scheduler.c\n@@ -993,7 +993,7 @@ Parrot_cx_schedule_sleep(PARROT_INTERP, \n     Parrot_cx_runloop_wake(interp, interp-\u003escheduler);\n\n```\n /* A more primitive, platform-specific, non-threaded form of sleep. */\n```\n-    if (time \u003e 1) {\n-    if (time \u003e= 1) {\n       /\\* prevent integer overflow when converting to microseconds\n        \\* and problems in platforms that doesn't allow usleep more\n        \\* than 1 second */","files":null}]}