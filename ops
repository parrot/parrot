{"version":1,"ops":[{"type":1,"author":{"id":"0c9c62332064205b2d799407019fa3e7e2f43862"},"timestamp":1348073694,"metadata":{"github-id":"MDU6SXNzdWU2OTg3MzI3","github-url":"https://github.com/parrot/parrot/issues/837","origin":"github"},"title":"concat opcode throws exception when handed unicode constant","message":"The concat opcode doesn't seem to be able to handle two constant arguments when either of them is encoded other than ASCII.  Here's the test program:\n\n```\npmichaud@kiwi:~/p6/nqp/parrot$ cat z1.pir\n.sub 'main' :main\n    concat $S1, unicode:\"\\x{a2}\", unicode:\"\\x{a2}\"\n    say $S1\n.end\n\npmichaud@kiwi:~/p6/nqp/parrot$ ./parrot z1.pir\nInvalid character in ASCII string\n```\n\nExpected output is \"¢¢\\n\".\n\nIt likewise fails if only one of the arguments is marked with an encoding:\n\n```\npmichaud@kiwi:~/p6/nqp/parrot$ cat z2.pir\n.sub 'main' :main\n    concat $S1, unicode:\"\\x{a2}\", \"c\"\n    say $S1\n.end\n\npmichaud@kiwi:~/p6/nqp/parrot$ ./parrot z2.pir\nInvalid character in ASCII string\n```\n\nIf both strings are ASCII, then things work fine:\n\n```\npmichaud@kiwi:~/p6/nqp/parrot$ cat z3.pir\n.sub 'main' :main\n    concat $S1, \"c\", \"c\"\n    say $S1\n.end\n\npmichaud@kiwi:~/p6/nqp/parrot$ ./parrot z3.pir\ncc\n```\n\nIndeed, if the two strings are marked unicode: but contain only ASCII characters, it works:\n\n```\npmichaud@kiwi:~/p6/nqp/parrot$ cat z4.pir\n.sub 'main' :main\n    concat $S1, unicode:\"\\x{62}\", unicode:\"\\x{62}\"\n    say $S1\n.end\n\npmichaud@kiwi:~/p6/nqp/parrot$ ./parrot z4.pir\nbb\n```\n\nThis appears to be the source of the problem for NQP issue #55 https://github.com/perl6/nqp/issues/55 .\n\nThis problem appears to have existed in Parrot for a long time -- at least back through 3.0.0.\n\nThanks!\n\nPm","files":null}]}