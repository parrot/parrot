{"version":1,"ops":[{"type":1,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1320109770,"metadata":{"github-id":"MDU6SXNzdWUyMTAzOTIy","github-url":"https://github.com/parrot/parrot/issues/187","origin":"github"},"title":"Decompressing archive tarball will overwrite source files","message":"Currently, running any of the following commands ...\n\n  perl t/harness --archive\n  perl t/fullharness --archive\n  make smolder_test\n  make smoke\n  make smolder_fulltest\n\n... will create a tarball called 'parrot_test_run.tar.gz' that sits in the top-level directory of the Parrot distribution.  This tarball is suitable for uploading to our Smolder server -- but don't try to peek inside!\n\nShould you decompress and untar this archive ...\n\n  tar xzf parrot_test_run.tar.gz\n\n... you will overwrite all the files in t/, as well as a couple of other files like 'config_lib.pir', 'myconfig', 'README', etc.  You will discover that, e.g., the files under t/ now contain the TAP output from running the tests -- not the source code of the tests.\n\nThe reason for this is that (for reasons extrinsic to Parrot) TAP::Harness::Archive adds files to an archive without first creating a separate top-level directory.  I think this is conceptually erroneous, but since it works with Smolder, we have to live with it.\n\nBut we don't have to live with the risk of overwriting our source-code files.  Granted, you can restore your files with a series of commands like:\n\n  git checkout -- t/\n\n... but that gets tedious.  As an expedient, I recommend that we create a new subdirectory, t/archive/, solely for the purpose of creating the archive in a place where it can be safely decompressed and untarred.\n\nI have created the jkeenan/reposition_archive_tarball branch in git to hold code which implements this functionality.  I have successfully created both a regular, 't/harness' archive and a 't/fullharness' archive there and sent them to Smolder (e.g., http://smolder.parrot.org/app/projects/report_details/24230 and http://smolder.parrot.org/app/projects/report_details/24232).  This diff may be helpful:  git diff f7b8d31f8..4603865e\n\nPlease review.","files":null}]}