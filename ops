{"version":1,"ops":[{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1344538848,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2MjM1NTc=","github-url":"https://github.com/parrot/parrot/issues/810#issuecomment-7623557"},"message":"More comparison data bad vs good, this time with #define RUNLOOP_TRACE in ops.c\n\n```\n$ tsan-r4356-amd64-linux-self-contained.sh ./parrot t/pmc/task.t\n==21897== ThreadSanitizer, a data race detector\n==21897== Copyright (C) 2008-2010, and GNU GPL'd, by Google Inc.\n==21897== Using Valgrind-3.8.0.SVN and LibVEX; rerun with -h for copyright info\n==21897== Command: ./parrot t/pmc/task.t\n==21897== \n==21897== ThreadSanitizerValgrind r4356: hybrid=no\n==21897== INFO: Allocating 256Mb (32 * 8M) for Segments.\n==21897== INFO: Will allocate up to 640Mb for 'previous' stack traces.\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[entering loop 1, level 1]\n[entering loop 2, level 2]\n[entering loop 3, level 3]\n[exiting loop 4, level 4]\n[entering loop 3, level 3]\n[exiting loop 5, level 4]\n[entering loop 3, level 3]\n[exiting loop 6, level 4]\n[exiting loop 3, level 3]\n[entering loop 2, level 2]\n[entering loop 7, level 3]\n[exiting loop 8, level 4]\n[entering loop 7, level 3]\n[entering loop 9, level 4]\n[exiting loop 10, level 5]\n[exiting loop 9, level 4]\n[exiting loop 7, level 3]\n[exiting loop 2, level 2]\n[entering loop 1, level 1]\n[exiting loop 11, level 2]\n1..6\n[entering loop 1, level 1]\n[exiting loop 12, level 2]\nok 1 - initialized\n[entering loop 0, level 0]\nok 2 task1 ran\n[exiting loop 1, level 1]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[entering loop 0, level 0]\nok 3 task2 ran[exiting loop 1, level 1]\n\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[entering loop 0, level 0]\nok 4 sub1 ran\n[exiting loop 1, level 1]\n==21897== INFO: T4 has been created by T0. Use --announce-threads to see the creation stack.\n==21897== INFO: T5 has been created by T0. Use --announce-threads to see the creation stack.\n==21897== WARNING: Possible data race during write of size 4 at 0x530F7C0: {{{\n==21897==    T5 (L{}):\n==21897==     #0  reset_runloop_id_counter /usr/src/parrot/threads/src/call/ops.c:155\n==21897==     #1  Parrot_thread_outer_runloop /usr/src/parrot/threads/src/thread.c:317\n==21897==   Concurrent write(s) happened at (OR AFTER) these points:\n==21897==    T4 (L{}):\n==21897==     #0  new_runloop_jump_point /usr/src/parrot/threads/src/call/ops.c:188\n==21897==     #1  runops /usr/src/parrot/threads/src/call/ops.c:88\n==21897==     #2  Parrot_pcc_invoke_from_sig_object /usr/src/parrot/threads/src/call/pcc.c:338\n==21897==     #3  Parrot_ext_call /usr/src/parrot/threads/src/extend.c:158\n==21897==     #4  Parrot_Task_invoke /usr/src/parrot/threads/src/pmc/task.c:168\n==21897==     #5  Parrot_pcc_invoke_from_sig_object /usr/src/parrot/threads/src/call/pcc.c:330\n==21897==     #6  Parrot_ext_call /usr/src/parrot/threads/src/extend.c:158\n==21897==     #7  Parrot_cx_next_task /usr/src/parrot/threads/src/scheduler.c:222\n==21897==     #8  Parrot_thread_outer_runloop /usr/src/parrot/threads/src/thread.c:319\n==21897==   Address 0x530F7C0 is 0 bytes inside data symbol \"runloop_id_counter\"\n==21897==    Race verifier data: 0x50073F3,0x5007477\n==21897== }}}\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[exiting loop 1, level 1]\n```\n\n... hang\n\nand the good case:    \n\n```\n$ ./parrot t/pmc/task.t\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[entering loop 1, level 1]\n[entering loop 2, level 2]\n[entering loop 3, level 3]\n[exiting loop 4, level 4]\n[entering loop 3, level 3]\n[exiting loop 5, level 4]\n[entering loop 3, level 3]\n[exiting loop 6, level 4]\n[exiting loop 3, level 3]\n[entering loop 2, level 2]\n[entering loop 7, level 3]\n[exiting loop 8, level 4]\n[entering loop 7, level 3]\n[entering loop 9, level 4]\n[exiting loop 10, level 5]\n[exiting loop 9, level 4]\n[exiting loop 7, level 3]\n[exiting loop 2, level 2]\n[entering loop 1, level 1]\n[exiting loop 11, level 2]\n1..6\n[entering loop 1, level 1]\n[exiting loop 12, level 2]\nok 1 - initialized\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\nok 2 task1 ran\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\nok 3 task2 ran\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[entering loop 0, level 0]\nok 4 sub1 ran\n[exiting loop 1, level 1]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\nok 5 Got message after block\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\nok 6 Got existing message\n[exiting loop 1, level 1]\n[entering loop 0, level 0]\n[exiting loop 1, level 1]\n\n$ diff -bu bad good\n--- bad 2012-08-09 13:58:30.045527269 -0500\n+++ good    2012-08-09 13:58:40.333434489 -0500\n@@ -1,12 +1,4 @@\n@@ -34,42 +26,32 @@\n     [entering loop 1, level 1]\n     [exiting loop 12, level 2]\n     ok 1 - initialized\n+    [exiting loop 1, level 1]\n     [entering loop 0, level 0]\n     ok 2 task1 ran\n     [exiting loop 1, level 1]\n-    [exiting loop 1, level 1]\n     [entering loop 0, level 0]\n+    [exiting loop 1, level 1]\n     [entering loop 0, level 0]\n-    ok 3 task2 ran[exiting loop 1, level 1]\n-    \n+    ok 3 task2 ran\n     [exiting loop 1, level 1]\n     [entering loop 0, level 0]\n     [entering loop 0, level 0]\n     ok 4 sub1 ran\n     [exiting loop 1, level 1]\n```","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1344888027,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MDYwNjY=","github-url":"https://github.com/parrot/parrot/issues/810#issuecomment-7706066"},"message":"Fixed with d752612c98239aab90442e0e2d08e149217ac93c by Stefan Seifert nine@detonation.org.","files":null},{"type":4,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1344888028,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjI2MDYyMTk="},"status":2}]}