{"version":1,"ops":[{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237678744,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNTk=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503259"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nThis is a problem for Debian as well, and apparently SuSE also (see ticket \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/474\" title=\"patch: [PATCH] improved parrot.spec for SUSE (closed: wontfix)\"\u003e#474\u003c/a\u003e). The patch attached to \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/474\" title=\"patch: [PATCH] improved parrot.spec for SUSE (closed: wontfix)\"\u003e#474\u003c/a\u003e isn't a general solution, so we'll probably want some way to disable rpath at configuration time.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237717427,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjA=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503260"},"message":"\u003cp\u003e\nDisabling rpath in general would be a bad plan.  It would make it harder for ordinary non-root users to build and install a version of parrot into any directory other than the directories searched by ld.so.  Disabling rpath_blib (as is done in TT \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/474\" title=\"patch: [PATCH] improved parrot.spec for SUSE (closed: wontfix)\"\u003e#474\u003c/a\u003e) is a bad idea -- how is the parrot built during the build process supposed to find libparrot.so?\n\u003c/p\u003e\n\n\u003cp\u003e\nWhat would likely be sufficient would be to leave rpath_blib as is, and change config/inter/libparrot.pm to skip setting up rpath_lib (the version that will be used on the installed parrot) if 'libdir' is /usr/lib.  (Ideally, I suppose, it should skip it for any directory already searched by ld.so, but that would require parsing the output of ldconfig or some other such tool, and I don't know how standard any of that is.)\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237758156,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjE=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503261"},"message":"3782 byte attachment from JSchmitt\nat http://trac.parrot.org/parrot/raw-attachment/ticket/476/config_no_rpath.diff\n\n```--- parrot-1.0.0.orig/config/gen/makefiles/json.in\n+++ parrot-1.0.0/config/gen/makefiles/json.in\n@@ -9,6 +9,8 @@\n PGE_DIR  := ../../compilers/pge\n TGE_DIR  := ../../compilers/tge\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # the default target\n all: JSON.pbc\n\n--- parrot-1.0.0.orig/config/gen/makefiles/nqp.in\n+++ parrot-1.0.0/config/gen/makefiles/nqp.in\n@@ -9,6 +9,8 @@\n PARROT_LIBRARY := @build_dir@/runtime/parrot/library\n PGE_LIBRARY    := @build_dir@/runtime/parrot/library/PGE\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n all: nqp.pbc\n\n SOURCES := \\\n--- parrot-1.0.0.orig/config/gen/makefiles/pct.in\n+++ parrot-1.0.0/config/gen/makefiles/pct.in\n@@ -11,6 +11,8 @@\n PGE_DIR  := ../../compilers/pge\n TEST_DIR := ../../t/compilers/pct\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY := ../../runtime/parrot/library\n\n--- parrot-1.0.0.orig/config/gen/makefiles/pge.in\n+++ parrot-1.0.0/config/gen/makefiles/pge.in\n@@ -9,6 +9,8 @@\n\n TOOL_DIR := ../..\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY := ../../runtime/parrot/library\n\n--- parrot-1.0.0.orig/config/gen/makefiles/root.in\n+++ parrot-1.0.0/config/gen/makefiles/root.in\n@@ -534,6 +534,8 @@\n .pbc$(O) : # suffix rule (limited support)\n    $(PARROT) -o $@ $\u003c\n\n+# This sets up proper internal dynamic linking in case we don't set an rpath\n+export LD_LIBRARY_PATH = $(CUR_DIR)/blib/lib\n\n ###############################################################################\n #\n@@ -750,7 +752,7 @@\n\n runtime/parrot/include/config.fpmc : myconfig config_lib.pasm $(MINIPARROT)\n    @echo Invoking Parrot to generate runtime/parrot/include/config.fpmc --cross your fingers\n-   $(MINIPARROT) config_lib.pasm \u003e $@\n-   LD_LIBRARY_PATH=$(CUR_DIR)/blib/lib $(MINIPARROT) config_lib.pasm \u003e $@\n  \n  $(PARROT) : $(SRC_DIR)/main$(O) $(GEN_HEADERS) $(LIBPARROT) CFLAGS \\\n     lib/Parrot/OpLib/core.pm $(SRC_DIR)/parrot_config$(O) \\\n  --- parrot-1.0.0.orig/config/gen/makefiles/tge.in\n  +++ parrot-1.0.0/config/gen/makefiles/tge.in\n  @@ -6,6 +6,8 @@\n  RM_F     := @rm_f@\n  PARROT   := ../../parrot@exe@\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY    := ../../runtime/parrot/library\n PERL6GRAMMAR      := $(PARROT_LIBRARY)/PGE/Perl6Grammar.pbc\n--- parrot-1.0.0.orig/config/inter/libparrot.pm\n+++ parrot-1.0.0/config/inter/libparrot.pm\n@@ -34,6 +34,7 @@\n sub runstep {\n     my ( $self, $conf ) = @_;\n     my $parrot_is_shared = $conf-\u003eoptions-\u003eget('parrot_is_shared');\n-    my $site_install = $conf-\u003eoptions-\u003eget('site_install');\n  \n   $parrot_is_shared = integrate(\n       $conf-\u003edata-\u003eget('parrot_is_shared'),\n  @@ -98,7 +99,8 @@\n   # Set -rpath (or equivalent) for executables to find the\n   # shared libparrot in the build directory.\n   $conf-\u003edata-\u003eset(\n-        rpath_blib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        rpath_blib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') \n-           \u0026\u0026 !$site_install )\n       ? $conf-\u003edata-\u003eget('rpath')\n           . $conf-\u003edata-\u003eget('build_dir')\n           . $conf-\u003edata-\u003eget('slash')\n  @@ -109,7 +111,8 @@\n   # Set -rpath (or equivalent) for the installed executables to find the\n   # installed shared libparrot.\n   $conf-\u003edata-\u003eset(\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath')\n-                       \u0026\u0026 !$site_install )\n       ? $conf-\u003edata-\u003eget('rpath')\n           . $conf-\u003edata-\u003eget('libdir')\n       : ''\n  --- parrot-1.0.0.orig/lib/Parrot/Configure/Options/Conf/Shared.pm\n  +++ parrot-1.0.0/lib/Parrot/Configure/Options/Conf/Shared.pm\n  @@ -62,6 +62,7 @@\n   sbindir\n   sharedstatedir\n   silent\n-    site_install\n   sysconfdir\n   test\n   verbose\n\n```\n```","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237763074,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjI=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503262"},"message":"3784 byte attachment from JSchmitt\nat http://trac.parrot.org/parrot/raw-attachment/ticket/476/parrot-1.0.0-norpath.diff\n\n```--- parrot-1.0.0.orig/config/gen/makefiles/json.in\n+++ parrot-1.0.0/config/gen/makefiles/json.in\n@@ -9,6 +9,8 @@\n PGE_DIR  := ../../compilers/pge\n TGE_DIR  := ../../compilers/tge\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # the default target\n all: JSON.pbc\n\n--- parrot-1.0.0.orig/config/gen/makefiles/nqp.in\n+++ parrot-1.0.0/config/gen/makefiles/nqp.in\n@@ -9,6 +9,8 @@\n PARROT_LIBRARY := @build_dir@/runtime/parrot/library\n PGE_LIBRARY    := @build_dir@/runtime/parrot/library/PGE\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n all: nqp.pbc\n\n SOURCES := \\\n--- parrot-1.0.0.orig/config/gen/makefiles/pct.in\n+++ parrot-1.0.0/config/gen/makefiles/pct.in\n@@ -11,6 +11,8 @@\n PGE_DIR  := ../../compilers/pge\n TEST_DIR := ../../t/compilers/pct\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY := ../../runtime/parrot/library\n\n--- parrot-1.0.0.orig/config/gen/makefiles/pge.in\n+++ parrot-1.0.0/config/gen/makefiles/pge.in\n@@ -9,6 +9,8 @@\n\n TOOL_DIR := ../..\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY := ../../runtime/parrot/library\n\n--- parrot-1.0.0.orig/config/gen/makefiles/root.in\n+++ parrot-1.0.0/config/gen/makefiles/root.in\n@@ -534,6 +534,8 @@\n .pbc$(O) : # suffix rule (limited support)\n    $(PARROT) -o $@ $\u003c\n\n+# This sets up proper internal dynamic linking in case we don't set an rpath\n+export LD_LIBRARY_PATH = $(CUR_DIR)/blib/lib\n\n ###############################################################################\n #\n@@ -750,7 +752,7 @@\n\n runtime/parrot/include/config.fpmc : myconfig config_lib.pasm $(MINIPARROT)\n    @echo Invoking Parrot to generate runtime/parrot/include/config.fpmc --cross your fingers\n-   $(MINIPARROT) config_lib.pasm \u003e $@\n-   LD_LIBRARY_PATH=$(CUR_DIR)/blib/lib $(MINIPARROT) config_lib.pasm \u003e $@\n  \n  $(PARROT) : $(SRC_DIR)/main$(O) $(GEN_HEADERS) $(LIBPARROT) CFLAGS \\\n     lib/Parrot/OpLib/core.pm $(SRC_DIR)/parrot_config$(O) \\\n  --- parrot-1.0.0.orig/config/gen/makefiles/tge.in\n  +++ parrot-1.0.0/config/gen/makefiles/tge.in\n  @@ -6,6 +6,8 @@\n  RM_F     := @rm_f@\n  PARROT   := ../../parrot@exe@\n\n+export LD_LIBRARY_PATH := ../../blib/lib\n+\n # Where to put things\n PARROT_LIBRARY    := ../../runtime/parrot/library\n PERL6GRAMMAR      := $(PARROT_LIBRARY)/PGE/Perl6Grammar.pbc\n--- parrot-1.0.0.orig/config/inter/libparrot.pm\n+++ parrot-1.0.0/config/inter/libparrot.pm\n@@ -34,6 +34,7 @@\n sub runstep {\n     my ( $self, $conf ) = @_;\n     my $parrot_is_shared = $conf-\u003eoptions-\u003eget('parrot_is_shared');\n-    my $site_install = $conf-\u003eoptions-\u003eget('disable-rpath');\n  \n   $parrot_is_shared = integrate(\n       $conf-\u003edata-\u003eget('parrot_is_shared'),\n  @@ -98,7 +99,8 @@\n   # Set -rpath (or equivalent) for executables to find the\n   # shared libparrot in the build directory.\n   $conf-\u003edata-\u003eset(\n-        rpath_blib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        rpath_blib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') \n-           \u0026\u0026 !$site_install )\n       ? $conf-\u003edata-\u003eget('rpath')\n           . $conf-\u003edata-\u003eget('build_dir')\n           . $conf-\u003edata-\u003eget('slash')\n  @@ -109,7 +111,8 @@\n   # Set -rpath (or equivalent) for the installed executables to find the\n   # installed shared libparrot.\n   $conf-\u003edata-\u003eset(\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath')\n-                       \u0026\u0026 !$site_install )\n       ? $conf-\u003edata-\u003eget('rpath')\n           . $conf-\u003edata-\u003eget('libdir')\n       : ''\n  --- parrot-1.0.0.orig/lib/Parrot/Configure/Options/Conf/Shared.pm\n  +++ parrot-1.0.0/lib/Parrot/Configure/Options/Conf/Shared.pm\n  @@ -62,6 +62,7 @@\n   sbindir\n   sharedstatedir\n   silent\n-    disable-rpath\n   sysconfdir\n   test\n   verbose\n\n```\n```","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237775328,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjM=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503263"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nI want to suggest the introduction of the configure flag which allow the user to dicide about the generation of rpaths.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237776156,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjQ=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503264"},"message":"Trac commenter: JSchmitt\n\n```\n    \u003cp\u003e\n```\n\nConfig option --site_install to disable rpath\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237776247,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjU=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503265"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nI've just attached a patch with a --site_install option to disable rpath when building for distros. It's not enabled by default so that testers and developers can proceed as usual. Note that I haven't patched all the compiler Makefile generators, only the ones I needed to build using the standard Configure.pl, but it should be trivial to do so.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237776947,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjY=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503266"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nCan you attached this file in a propper downloadable format?\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237777097,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjc=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503267"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:6\" title=\"Comment 6 for Ticket #476\"\u003eJSchmitt\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Can you attached this file in a propper downloadable format?\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nIt's the link at the bottom of the page showing the diff. Here it is in case you can't get to it:\n\u003c/p\u003e\n\n\u003cp\u003e\n\u003ca href=\"https://trac.parrot.org/parrot/raw-attachment/ticket/476/config_no_rpath.diff\"\u003ehttps://trac.parrot.org/parrot/raw-attachment/ticket/476/config_no_rpath.diff\u003c/a\u003e\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237778726,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjg=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503268"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nThank you, the patch works well. But I want to suggest, that you should rename the option into --disable-rpath, so you know directly what task this option has.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237779798,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNjk=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503269"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:8\" title=\"Comment 8 for Ticket #476\"\u003eJSchmitt\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Thank you, the patch works well. But I want to suggest, that you should rename the option into --disable-rpath, so you know directly what task this option has.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nSure, I'm fine with that. I picked site_install because I thought there might be things other than disabling rpath that would be important for doing this sort of install. This lets us have a single option for these things, although since I don't know of any currently using disable-rpath is fine. If someone with commit privs wants me to re-make the patch using this as the option name please let me know.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237781074,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzA=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503270"},"message":"Trac commenter: JSchmitt\n\n```\n    \u003cp\u003e\n```\n\nPatch to implement a --disable-rpath option\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237781128,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzE=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503271"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nI have added a patch where I have renamed the option into --disable-rpath\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1237787971,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzI=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503272"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:10\" title=\"Comment 10 for Ticket #476\"\u003eJSchmitt\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n I have added a patch where I have renamed the option into --disable-rpath\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nPatch, if adopted, will need a brief description of the function of the \u003ctt\u003e--disable-rpath\u003c/tt\u003e option in an appropriate part of the usage message found in \u003ctt\u003eprint_help()\u003c/tt\u003e \u003ci\u003elib/Parrot/Configure/Options/Conf.pm\u003c/i\u003e.\n\u003c/p\u003e\n\n\u003cp\u003e\n\u003ctt\u003e--disable-rpath\u003c/tt\u003e should also be placed alphabetically within the list in \u003ci\u003elib/Parrot/Configure/Options/Conf/Shared.pm\u003c/i\u003e.\n\u003c/p\u003e\n\n\u003cp\u003e\nThank you very much.\u003cbr /\u003e\nkid51\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237836720,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzM=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503273"},"message":"\u003cp\u003e\nPlease don't apply this patch.  There are several problems.\n\u003c/p\u003e\n\n\u003cp\u003e\n1.  The syntax \u003ctt\u003e export LD_LIBRARY_PATH = ../../blib/lib  \u003c/tt\u003e is not portable syntax for a makefile.\n\u003c/p\u003e\n\n\u003cp\u003e\n2.  The command \u003ctt\u003e LD_LIBRARY_PATH = ../../blib/lib  \u003c/tt\u003e unconditionally overwrites the user's setting of LD_LIBRARY_PATH.  That's bad, particularly if the user had deliberately set LD_LIBRARY_PATH to something useful on that particular system.\n\u003c/p\u003e\n\n\u003cp\u003e\n3.  The environment variable LD_LIBRARY_PATH goes by different names on different systems.\n\u003c/p\u003e\n\n\u003cp\u003e\n4.  The disabling of rpath for the build library seems to me to be wholly unnecessary.  I gather the desire is to avoid setting rpath in the *installed* versions of the utilities, but I don't understand at all why it would be necessary to avoid setting it for the build versions.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237843423,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzQ=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503274"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:13\" title=\"Comment 13 for Ticket #476\"\u003edoughera\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Please don't apply this patch.  There are several problems.\n 1.  The syntax \u003ctt\u003e export LD_LIBRARY_PATH = ../../blib/lib  \u003c/tt\u003e is not portable syntax for a makefile.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nI decided to do this because it seemed simplest, although I am admittedly biased towards GNU make. I can move the LD_LIBRARY_PATH = ... in front of each call to $(PARROT) in the makefile instead, which should be portable. I'll post a patch with that sometime soon unless someone beats me to it.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n 2.  The command \u003ctt\u003e LD_LIBRARY_PATH = ../../blib/lib  \u003c/tt\u003e unconditionally overwrites the user's setting of LD_LIBRARY_PATH.  That's bad, particularly if the user had deliberately set LD_LIBRARY_PATH to something useful on that particular system.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nThis is indeed an issue. Setting LD_LIBRARY_PATH = $(LD_LIBRARY_PATH):../../blib/lib would trivially solve this.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n 3.  The environment variable LD_LIBRARY_PATH goes by different names on different systems.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nPorters for those systems who are interested in building without rpath should make the necessary fixes for their system. For linux systems this is the correct environment variable to use. Furthermore, it's silly to block this patch for a non-default configure option that's important to the major linux distros. Other systems won't be affected by this unless they want to be.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n 4.  The disabling of rpath for the build library seems to me to be wholly unnecessary.  I gather the desire is to avoid setting rpath in the *installed* versions of the utilities, but I don't understand at all why it would be necessary to avoid setting it for the build versions.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nDo you have an alternative suggestion then? Every Linux distro that I've seen so far (including Debian/Ubuntu, Redhat/Fedora, and SuSE) needs for rpath to be removed, and there is no need to require it to be set for the build process.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237874391,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzU=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503275"},"message":"1269 byte attachment from doughera\nat http://trac.parrot.org/parrot/raw-attachment/ticket/476/rpath-lib-patch.txt\n\n```--- parrot-svn/config/inter/libparrot.pm 2009-03-21 21:02:56.000000000 -0400\n+++ parrot-andy/config/inter/libparrot.pm   2009-03-23 23:49:57.118939305 -0400\n@@ -107,13 +107,21 @@\n     );\n\n```\n # Set -rpath (or equivalent) for the installed executables to find the\n```\n-    # installed shared libparrot.\n-    $conf-\u003edata-\u003eset(\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        ? $conf-\u003edata-\u003eget('rpath')\n-            . $conf-\u003edata-\u003eget('libdir')\n-        : ''\n-    );\n-    # installed shared libparrot.  Don't set rpath if the library\n-    # directory is going to be searched by ld.so anyway.  For now,\n-    # hard-code those directories as qw(/lib /usr/lib /usr/lib64).\n-    if ($parrot_is_shared \u0026\u0026 $\n-         conf-\u003edata-\u003eget('rpath') \u0026\u0026 \n-         $conf-\u003edata-\u003eget('libdir') ne '/lib' \u0026\u0026\n-         $conf-\u003edata-\u003eget('libdir') ne '/usr/lib' \u0026\u0026\n-         $conf-\u003edata-\u003eget('libdir') ne '/usr/lib64') {\n-        $conf-\u003edata-\u003eset( rpath_lib =\u003e \n-            $conf-\u003edata-\u003eget('rpath') . $conf-\u003edata-\u003eget('libdir')\n-        );\n-    }\n-    else { \n-        $conf-\u003edata-\u003eset( rpath_lib =\u003e \"\");\n-    }\n  \n   unless ( defined( $conf-\u003edata-\u003eget('libparrot_ldflags') ) ) {\n       $conf-\u003edata-\u003eset(libparrot_ldflags =\u003e\n\n```\n```","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237892317,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzY=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503276"},"message":"\u003cp\u003e\nI appreciate that some Linux distributions have a policy against using rpath.\n(I do not understand precisely why they have such a policy, but I also am not\nout to try to change it.)  I also appreciate that you simply want to fix this\nminor problem and get on with other things.\n\u003c/p\u003e\n\n\u003cp\u003e\nHowever, the suggested patch leaves behind a little bit of a maintenance mess\nin parrot's Configure and Makefile, and I think it would be nice to try to\nclean it up first.\n\u003c/p\u003e\n\n\u003cp\u003e\nAlthough your needs are specific to parrot on Linux, I can easily imagine\nother packagers wishing to use the same functionality, hence my request to\ntry to make it more portable and general.  This is part of my overall bias\nthat, to the extent reasonable, things in Configure.pl ought to be done in\nways that are general and extensible.\n\u003c/p\u003e\n\n\u003cp\u003e\nThe whole thing would not be an issue if Configure.pl offered you a way to\nspecify arbitrary Configure variables at the command line, something like\n\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\n\u003ctt\u003e  perl Configure.pl --with-rpath_lib=\"\" \u003c/tt\u003e\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nAlas it doesn't.  A patch to allow it to do so would be *very* welcome.\n(But it would also be a *lot* of work; I do not expect anyone to actually\nimplement it.)\n\u003c/p\u003e\n\n\u003cp\u003e\nInstead you have proposed adding a specific Configure.pl flag, to be added\nto Configure.pl's existing hodge-podge of conflicting command-line flag\nstyles.  Again, that pre-existing hodge-podge is neither your problem nor\nyour responsibility.  However, it does give some of the background for why I\nam resistant to simply adding more.\n\u003c/p\u003e\n\n\u003cp\u003e\nI also think you have missed the important distinction between rpath_blib\n(which is used only during the build process) and rpath_lib (which is used for\nthe installed executables).  Surely the RedHat (and SuSE and Debian) policies\nhave to do with not using rpath in the executables that are actually installed,\nnot with the executables that are built and used merely as part of the build\nprocess.  I understand that you *can* get rid of rpath during the build process and replace it by the LD_LIBRARY_PATH settings.  I just don't see why you have to.\n\u003c/p\u003e\n\n\u003cp\u003e\nFortunately, as I have already discussed in my reply 2 days ago, a much easier and more general solution already exists:  Simply have config/inter/libparrot.pm skip the\nrpath_lib stuff if the library directory is one which is going to be searched\nby ld.so anyway.  A simple test of '/lib' or '/usr/lib' (or '/usr/lib64', if\nit exists) should suffice.  I would think this would work for *BSD and Solaris\nas well as Linux, without any environment variable fiddling or Makefile\npatching.  If it doesn't work for some reason, then it would make sense to\nconsider some more complicated fix.\n\u003c/p\u003e\n\n\u003cp\u003e\nI've thrown together a proof-of-concept patch to show exactly what I mean.  I'm sure it could be gussied up a bit, and I haven't tested it, but this is my alternative suggestion.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237892391,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzc=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503277"},"message":"\u003cp\u003e\nPatch to skip unnecessary rpath_lib setting\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"56b030459ff5c3e63b58d71e1bed10897e6a7686"},"timestamp":1237892771,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzg=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503278"},"message":"\u003cp\u003e\nHow about we skip rpath for installable Parrots, figuring that anyone who installs a libparrot to somewhere that ld doesn't see can figure out how to make it work?  I assume that we can pass the appropriate \"look in blib/lib to find libparrot\" flag when compiling the installable files, and that installing them won't hurt anything.  If that's not the case, then ignore this comment.\n\u003c/p\u003e\n\n\u003cp\u003e\nThe only time we really need to use rpath is when linking an application we don't intend to install -- when building a Parrot to run from the checkout directory.  Am I right?\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1237927257,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyNzk=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503279"},"message":"\u003cp\u003e\nI appear to need rpath to link a binary I \u003cstrong\u003edo\u003c/strong\u003e intend to install (for OS X). The installed binary is linked against the libs in the build dir otherwise.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237934162,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODA=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503280"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:16\" title=\"Comment 16 for Ticket #476\"\u003echromatic\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n How about we skip rpath for installable Parrots, figuring that anyone who installs a libparrot to somewhere that ld doesn't see can figure out how to make it work?\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nActually that's the exact situation for which I created the rpath_lib stuff in the first place.  Using rpath in that situation is a very natural and useful way to make it just work.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n I assume that we can pass the appropriate \"look in blib/lib to find libparrot\" flag when compiling the installable files, and that installing them won't hurt anything.  If that's not the case, then ignore this comment.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nAlas, the executable can \"remember\" the build directory then.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n The only time we really need to use rpath is when linking an application we don't intend to install -- when building a Parrot to run from the checkout directory.  Am I right?\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nThat certainly is one time when rpath is very useful.  (Not strictly necessary, but very convenient and useful.)  I don't understand why it would be a problem, and said so repeatedly above, but gravity claims it is, even for things we don't intend to install.  I can't imagine why, and think there must be some miscommunication somewhere.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237934405,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODE=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503281"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:17\" title=\"Comment 17 for Ticket #476\"\u003ecoke\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n I appear to need rpath to link a binary I \u003cstrong\u003edo\u003c/strong\u003e intend to install (for OS X). The installed binary is linked against the libs in the build dir otherwise.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nI didn't think the OS X rpath stuff worked at all.  If you have found a set of commands that will finally make it installable on OS X with a shared libparrot, I'll take a look and see what the Configure system can do to make that work.  If it means my patch above is wrong, then so be it.  Alas, I don't have any OS X experience.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237934660,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODI=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503282"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:18\" title=\"Comment 18 for Ticket #476\"\u003edoughera\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n That certainly is one time when rpath is very useful.  (Not strictly necessary, but very convenient and useful.)  I don't understand why it would be a problem, and said so repeatedly above, but gravity claims it is, even for things we don't intend to install.  I can't imagine why, and think there must be some miscommunication somewhere.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nYes, there is indeed a miscommunication. I don't think there's a problem using rpath for things that aren't intended to be installed. That's why I named the original config option \"site_install\" in order to explicitly denote that. I also do think it's useful to use rpath for non-installed parrot, which is why I made it a configuration option rather than a blanket removal of rpath use from the build system. I only want to be able to build parrot without using rpath for systemwide installs as by distro packages.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237935089,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODM=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503283"},"message":"Trac commenter: JSchmitt\n\n\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:16\" title=\"Comment 16 for Ticket #476\"\u003echromatic\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n How about we skip rpath for installable Parrots, figuring that anyone who installs a libparrot to somewhere that ld doesn't see can figure out how to make it work?  I assume that we can pass the appropriate \"look in blib/lib to find libparrot\" flag when compiling the installable files, and that installing them won't hurt anything.  If that's not the case, then ignore this comment.\n The only time we really need to use rpath is when linking an application we don't intend to install -- when building a Parrot to run from the checkout directory.  Am I right?\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nThis is exactly what the patch I wrote should be doing. If it's not then I did something very wrong and I'd love to hear what so I can fix it. The goal was to explicitly tell the configure script that you're building an installable parrot (using the site_install option, although that name kinda sucks) and so it takes the appropriate action to disable rpath. Otherwise, the build system works as before.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0c1ee4af33970ee80260d659da672a9306b51181"},"timestamp":1237936926,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODQ=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503284"},"message":"\u003cp\u003e\nYou've all almost got it. Parrot already does custom linking for installable_parrot. When you set the prefix to \"/usr\", it sets rpath in installable_parrot to \"/usr/lib\". Which is silly when \"/usr/lib\" is already part of the library path.\n\u003c/p\u003e\n\n\u003cp\u003e\nWe can't know which library paths the user will have set up on their system, so selecting by path isn't a good solution.\n\u003c/p\u003e\n\n\u003cp\u003e\na) Add a --disable-rpath option that only disables the rpath option on installable_parrot (so the build parrot continues working as-is). This means only setting the 'rpath_lib' option to blank, but leaving the 'rpath_blib' option configured as usual. (Yes, those were terrible names for the options, but let's not rename them at the moment.)\n\u003c/p\u003e\n\n\u003cp\u003e\nb) Don't set LD_LIBRARY_PATH in the Parrot build process. If the user requested --disable-rpath, then they can take the extra steps to set LD_LIBRARY_PATH or their platform equivalent. The documentation and command-line help for the --disable-rpath option should instruct the user to do this.\n\u003c/p\u003e\n\n\u003cp\u003e\nc) Follow Jim Keenan's recommendations on documentation and sort order.\n\u003c/p\u003e\n\n\u003cp\u003e\nd) Add configure tests to make sure the --disable-rpath option has the desired result.\n\u003c/p\u003e\n\n\u003cp\u003e\nAllison\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237943394,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODU=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503285"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:21\" title=\"Comment 21 for Ticket #476\"\u003egravity\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n This is exactly what the patch I wrote should be doing. If it's not then I did something very wrong and I'd love to hear what so I can fix it.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nYour patch is *also* removing rpath from the build process for things that are not being installed -- look at the parts changing rpath_blib.  That's what I mean about the distinction between rpath_lib and rpath_blib.  I understand you want to change rpath_lib.  I don't understand why your patch changes rpath_blib.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237944389,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODY=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503286"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:22\" title=\"Comment 22 for Ticket #476\"\u003eallison\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n You've all almost got it. Parrot already does custom linking for installable_parrot. When you set the prefix to \"/usr\", it sets rpath in installable_parrot to \"/usr/lib\". Which is silly when \"/usr/lib\" is already part of the library path.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nSilly, but harmless, I would think.  Still I do understand it runs afoul of some rigid Linux packaging system guidelines.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n We can't know which library paths the user will have set up on their system, so selecting by path isn't a good solution.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nTrue, it's not ideal, and we don't want to get in the business of parsing ldconfig output.  Another inconsistently-named hand-parsed and hand-tested Configure option isn't ideal either, but the difference between the two approaches isn't that big a deal to me, as long as I don't have to do it.  Both are working around a fundamental weakness in Configure.pl, namely that the user can't directly set rpath_lib from the Configure.pl command line.\n\u003c/p\u003e\n\n\u003cp\u003e\nThe bigger issue for me is the rpath_lib vs. rpath_blib distinction.  All 4 of my numbered objections above are specific to rpath_blib.  If we leave rpath_blib alone, they are automatically rendered moot.  I primarily intended my patch as a proof-of-concept patch that could demonstrate that rpath_blib didn't need any changes at all.  My verbal descriptions of the differences between rpath_blib and rpath_lib have apparently not been sufficiently clear.  Accordingly, I thought a patch might be clearer.  That's all.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237965408,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODc=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503287"},"message":"4178 byte attachment from doughera\nat http://trac.parrot.org/parrot/raw-attachment/ticket/476/rpath_lib-2.patch\n\n```diff -r -u parrot-current/config/init/defaults.pm parrot-andy/config/init/defaults.pm\n--- parrot-current/config/init/defaults.pm  2009-03-21 21:02:56.000000000 -0400\n+++ parrot-andy/config/init/defaults.pm 2009-03-25 00:10:33.701938937 -0400\n@@ -129,6 +129,21 @@\n         # -shared for GNU ld.\n         ld_load_flags =\u003e $Config{lddlflags},\n-        # Set -rpath (or equivalent) to append to $linkflags (and\n-        # $ldflags) for executables to find the shared libparrot in\n-        # the build directory.\n-        # This is often something like -R $builddir/blib/lib\n-        # (This is initialized to undef so that later parts of\n-        # Configure.pl can distinguish between the variable being\n-        # unset and being set (on the command line) to the empty\n-        # string.)\n-        rpath_blib =\u003e undef,\n  +\n-        # Set -rpath (or equivalent) for the installed executables to\n-        # find the installed shared libparrot.  \n-        # This is often something like -R /usr/local/lib\n- ```\n     rpath_lib =\u003e undef,\n  ```\n  \n  +\n       libs =\u003e $Config{libs},\n  \n  ```\n   cc_inc     =\u003e \"-I./include\",\n  ```\n  \n  diff -r -u parrot-current/config/inter/libparrot.pm parrot-andy/config/inter/libparrot.pm\n  --- parrot-current/config/inter/libparrot.pm    2009-03-21 21:02:56.000000000 -0400\n  +++ parrot-andy/config/inter/libparrot.pm   2009-03-25 00:49:53.213944808 -0400\n  @@ -97,22 +97,30 @@\n  \n   # Set -rpath (or equivalent) for executables to find the\n   # shared libparrot in the build directory.\n-    $conf-\u003edata-\u003eset(\n-        rpath_blib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        ? $conf-\u003edata-\u003eget('rpath')\n-            . $conf-\u003edata-\u003eget('build_dir')\n-            . $conf-\u003edata-\u003eget('slash')\n-            . $conf-\u003edata-\u003eget('blib_dir')\n-        : ''\n-    );\n-    # Respect a hint file or command-line override.\n-    my $rpath_blib = $conf-\u003eoption_or_data('rpath_blib');\n-    if (!defined($rpath_blib)) {\n-        $rpath_blib = ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-            ? $conf-\u003edata-\u003eget('rpath')\n-                . $conf-\u003edata-\u003eget('build_dir')\n-                . $conf-\u003edata-\u003eget('slash')\n-                . $conf-\u003edata-\u003eget('blib_dir')\n-            : '';\n-    }\n  \n   # Set -rpath (or equivalent) for the installed executables to find the\n   # installed shared libparrot.\n-    my $rpath_lib = $conf-\u003eoption_or_data('rpath_lib');\n-    if (!defined($rpath_lib)) {\n-        $rpath_lib = ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-            ? $conf-\u003edata-\u003eget('rpath')\n-                . $conf-\u003edata-\u003eget('libdir')\n-            : '';\n-    }\n  +\n   $conf-\u003edata-\u003eset(\n-        rpath_lib =\u003e ( $parrot_is_shared \u0026\u0026 $conf-\u003edata-\u003eget('rpath') )\n-        ? $conf-\u003edata-\u003eget('rpath')\n-            . $conf-\u003edata-\u003eget('libdir')\n-        : ''\n-        rpath_blib =\u003e $rpath_blib,\n- ```\n     rpath_lib  =\u003e $rpath_lib\n  ```\n  \n   );\n  \n   unless ( defined( $conf-\u003edata-\u003eget('libparrot_ldflags') ) ) {\n  diff -r -u parrot-current/lib/Parrot/Configure/Options/Conf/Shared.pm parrot-andy/lib/Parrot/Configure/Options/Conf/Shared.pm\n  --- parrot-current/lib/Parrot/Configure/Options/Conf/Shared.pm  2009-03-21 21:02:48.000000000 -0400\n  +++ parrot-andy/lib/Parrot/Configure/Options/Conf/Shared.pm 2009-03-25 00:17:38.418939204 -0400\n  @@ -58,6 +58,7 @@\n   parrot_is_shared\n   prefix\n   profile\n-    rpath_lib\n   sbindir\n   sharedstatedir\n   silent\n  diff -r -u parrot-current/lib/Parrot/Configure/Options/Conf.pm parrot-andy/lib/Parrot/Configure/Options/Conf.pm\n  --- parrot-current/lib/Parrot/Configure/Options/Conf.pm 2009-03-21 21:02:48.000000000 -0400\n  +++ parrot-andy/lib/Parrot/Configure/Options/Conf.pm    2009-03-25 00:18:04.834939494 -0400\n  @@ -133,6 +133,9 @@\n                           [/usr/local]\n   --exec-prefix=EPREFIX   Install architecture-dependent files in EPREFIX\n                           [PREFIX]\n-    --rpath_lib=RPATH       add RPATH into link flags to tell the\n-                            installed parrot how to find the installed \n- ```\n                         version of libparrot.so (if appropriate).\n  ```\n  \n   By default, `make install' will install all the files in\n  `/usr/local/bin', `/usr/local/lib' etc.  You can specify\n\n```\n```","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237983360,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODg=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503288"},"message":"\u003cp\u003e\nI've attached a patch which allows you to set rpath_lib directly to whatever is needed, including setting it to the empty string.  Thus to meet the original needs of this ticket, you would type\n\u003c/p\u003e\n\n\u003cpre class=\"wiki\"\u003e     perl Configure.pl --rpath_lib=\"\"\n\u003c/pre\u003e\u003cp\u003e\n(i.e. set it to the empty string).  This has the advantage of being a more general solution -- should users on other platforms find Configure's built-in guesses for how to set rpath to be incorrect, this gives them a workaround way to specify the correct flags.  (I didn't quite go all all the way towards implementing a general way to specify Configure.pl variables, but I was tempted.)\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1237983408,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyODk=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503289"},"message":"\u003cp\u003e\nA patch to allow specifying rpath_lib on the Configure.pl command line\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0c1ee4af33970ee80260d659da672a9306b51181"},"timestamp":1238479377,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTA=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503290"},"message":"\u003cp\u003e\nWe have an immediate use case for --disable-rpath, and it's a standard option in the Linux world. We don't have a use case for setting rpath_lib directly, since it's already set when the user sets the installation paths.\n\u003c/p\u003e\n\n\u003cp\u003e\nWe can always add direct rpath_lib setting later if/when someone has a specific need for it.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0c1ee4af33970ee80260d659da672a9306b51181"},"timestamp":1238487427,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTE=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503291"},"message":"\u003cp\u003e\nTurns out, the option has to disable rpath_blib too, otherwise dynamic PMCs and ops are built with the blib/lib rpath.\n\u003c/p\u003e\n\n\u003cp\u003e\nCommitted in r37823. Resolving ticket.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1238529352,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTI=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503292"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:27\" title=\"Comment 27 for Ticket #476\"\u003eallison\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Turns out, the option has to disable rpath_blib too, otherwise dynamic PMCs and ops are built with the blib/lib rpath.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nThat sounds to me like there's a bug in the build system, then.  In no case should installed files depend on the build directory.  This merely papers over that bug for the case of Linux packagers.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Committed in r37823. Resolving ticket.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nI'll let you decide whether to reopen this ticket, or resolve it, open a new ticket for the dynpmc linking bug, and refer back to here to unapply the rpath_blib bits once that new ticket it resolved.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1239058755,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTM=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503293"},"message":"\u003cp\u003e\nI created a new ticket TT \u003ca class=\"reopened ticket\" href=\"http://trac.parrot.org/parrot/ticket/540\" title=\"bug: installed versions of dynext/*.so still link to -lparrot in build ... (reopened)\"\u003e#540\u003c/a\u003e specifically about the dynamic PMCs incorrectly linking to the build path.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1243373240,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTQ=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503294"},"message":"\u003cp\u003e\nNow that TT \u003ca class=\"reopened ticket\" href=\"http://trac.parrot.org/parrot/ticket/540\" title=\"bug: installed versions of dynext/*.so still link to -lparrot in build ... (reopened)\"\u003e#540\u003c/a\u003e is fixed, the part of this patch that disables rpath_blib can be reverted.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0c1ee4af33970ee80260d659da672a9306b51181"},"timestamp":1247656752,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTU=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503295"},"message":"\u003cp\u003e\nThe --disable-rpath option isn't a workaround for a bug, it's a needed feature for building Linux packages. And, it's not much use unless it disables -rpath everywhere. (We could add --disable-rpath and --really-disable-rpath options, but that'd be a bit silly since the only time you need the option is when you *really* need it.)\n\u003c/p\u003e\n\n\u003cp\u003e\nNo changes and reclosing ticket.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1247693413,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTY=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503296"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:32\" title=\"Comment 32 for Ticket #476\"\u003eallison\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n The --disable-rpath option isn't a workaround for a bug, it's a needed feature for building Linux packages.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nNo, you are misunderstanding me.  The disable-rpath option currently does *two* things:  it disables rpath_blib (which is used only in the build directory) and rpath_lib (which is used for the installables).  The bug in TT \u003ca class=\"reopened ticket\" href=\"http://trac.parrot.org/parrot/ticket/540\" title=\"bug: installed versions of dynext/*.so still link to -lparrot in build ... (reopened)\"\u003e#540\u003c/a\u003e is that dynamic PMCS intended to be installed were linking to things in the build directory.  The disable-rpath option worked around that bug by disabling rpath_blib.  Now that the bug in TT \u003ca class=\"reopened ticket\" href=\"http://trac.parrot.org/parrot/ticket/540\" title=\"bug: installed versions of dynext/*.so still link to -lparrot in build ... (reopened)\"\u003e#540\u003c/a\u003e is fixed, the disable-rpath option no longer has to disable rpath_blib.  Phrased differently, disabling rpath_blib should never be necessary because nothing linked with rpath_blib should ever be installed.\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n And, it's not much use unless it disables -rpath everywhere.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nNo.  As I have tried to explain over and over again, but apparently to no avail, disabling rpath_blib should be unnecessary.  Yes, I understand the packager can work around it by using LD_LIBRARY_PATH (or equivalent).  But that work-around would not be required if parrot didn't disable rpath_blib in the first place.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1256858473,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTc=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503297"},"message":"\u003cp\u003e\ndoughera's thread throughout this ticket of rpath_lib vs. rpath_blib is never addressed. Re-opening ticket.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1298626201,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTg=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503298"},"message":"\u003cp\u003e\nAndy,\n\u003c/p\u003e\n\n\u003cp\u003e\nThis is another ticket where, if you could shed some light on the current status of the issues, it would be appreciated.\n\u003c/p\u003e\n\n\u003cp\u003e\nThank you very much.\n\u003c/p\u003e\n\n\u003cp\u003e\nkid51\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1298675371,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDMyOTk=","github-url":"https://github.com/parrot/parrot/issues/471#issuecomment-3503299"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/476#comment:35\" title=\"Comment 35 for Ticket #476\"\u003ejkeenan\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n Andy,\n This is another ticket where, if you could shed some light on the current status of the issues, it would be appreciated.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nNothing has changed.\n\u003c/p\u003e","files":null}]}