{"version":1,"ops":[{"type":1,"author":{"id":"531f213490a150dd157bb329db78197c5d1f681e"},"timestamp":1272112782,"metadata":{"github-id":"MDU6SXNzdWUyODQ4NTcx","github-url":"https://github.com/parrot/parrot/issues/368","origin":"github"},"title":"Move . to the end of the library search path","message":"Here's a snippet of strace output after I accidentally ran parrot-nqp in a directory with a Regex.pbc file:\n\n```\nstat64(\"./Regex.pbc\", {st_mode=S_IFREG|0644, st_size=100432, ...}) = 0\nopen(\"./Regex.pbc\", O_RDONLY|O_LARGEFILE) = 3\nstat64(\"./P6object.pbc\", 0xbf9ee9bc)    = -1 ENOENT (No such file or directory)\nstat64(\"./P6object.pir\", 0xbf9ee9bc)    = -1 ENOENT (No such file or directory)\nstat64(\"./P6object.pasm\", 0xbf9ee9bc)   = -1 ENOENT (No such file or directory)\nstat64(\"./P6object.pbc\", 0xbf9ee9bc)    = -1 ENOENT (No such file or directory)\nstat64(\"/usr/local/./P6object.pbc\", 0xbf9ee9bc) = -1 ENOENT (No such file or directory)\nstat64(\"/usr/local/./P6object.pir\", 0xbf9ee9bc) = -1 ENOENT (No such file or directory)\nstat64(\"/usr/local/./P6object.pasm\", 0xbf9ee9bc) = -1 ENOENT (No such file or directory)\nstat64(\"/usr/local/./P6object.pbc\", 0xbf9ee9bc) = -1 ENOENT (No such file or directory)\nstat64(\"/usr/local/lib/parrot/2.3.0-devel/library/P6object.pbc\", {st_mode=S_IFREG|0644, st_size=18448, ...}) = 0\nstat64(\"/usr/local/lib/parrot/2.3.0-devel/library/P6object.pbc\", {st_mode=S_IFREG|0644, st_size=18448, ...}) = 0\nstat64(\"/usr/local/lib/parrot/2.3.0-devel/library/P6object.pbc\", {st_mode=S_IFREG|0644, st_size=18448, ...}) = 0\nstat64(\"/usr/local/lib/parrot/2.3.0-devel/library/P6object.pbc\", {st_mode=S_IFREG|0644, st_size=18448, ...}) = 0\nopen(\"/usr/local/lib/parrot/2.3.0-devel/library/P6object.pbc\", O_RDONLY|O_LARGEFILE) = 3\n```\n\nParrot has taken Regex.pbc in the current directory before even checking for it in the standard libraries.  The same behavior occurs with all other Parrot-based programs which use installed libraries.  This provides an attack vector against Parrot users:\n1. Wait for Perl6-on-Parrot to hit the big time.\n2. Distribute a shady tarball containing a malicious P6Regex.pbc inside it.\n3. The victim unpacks the tarball and attempts to analyze the contents.\n4. The user runs his Perl 6 based editor.\n5. Rakudo loads Perl6.pbc from the current directory.  My code is now running.\n\nIt's probably best to follow Perl 5's example here:\n\n```\n$ perl -V\n...\n  @INC:\n    /usr/local/lib/perl5/site_perl/5.12.0/i686-linux-thread-multi\n    /usr/local/lib/perl5/site_perl/5.12.0\n    /usr/local/lib/perl5/5.12.0/i686-linux-thread-multi\n    /usr/local/lib/perl5/5.12.0\n    .\n```\n\nWith the current directory at the end, installed programs which use only installed libraries will never be tricked into running code in the current directory.  Hopefully it is not too common for installed programs to reference nonexistant libraries.\n\nOriginally http://trac.parrot.org/parrot/ticket/1589","files":null}]}