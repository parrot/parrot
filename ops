{"version":1,"ops":[{"type":1,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1256724767,"metadata":{"github-id":"MDU6SXNzdWUyODQ4NTYx","github-url":"https://github.com/parrot/parrot/issues/360","origin":"github"},"title":"dynext - dll versioning","message":"Thanks to the Windows DLL Hell Lhttp://en.wikipedia.org/wiki/DLL_hell \nand the impossibility of file hardlinks, windows dll names are hopefully \nversioned, so either the loadlib function or the various pir's needs \nmore logic for maintainance convenience.\n\nKeep the lib_paths and share_ext search, add more name munging for \nspecial platforms.\n\nEither\n1) add the version to each loadlib call, and stem the version from\nPOSIX versions within get_path().\n\nloadlib lib, 'libSDL-1.2.so.0'\n\n=\u003e try: libSDL-1.2.so.0, libSDL-1.2.so\n\nstemmed: libSDL.so\non WIN32: SDL-1.2.dll, SDL.dll\non cygwin: cygSDL-1.2.dll, cygSDL.dll\n\nMaybe also detect the \"-1.2.so.0\" and convert it to \"-1.2.0.dll\"\n\n2) add an optional version argument to loadlib. (preferred)\n\nloadlib lib, 'SDL', '1.2.0'\n\n=\u003e Try: first always prefix with \"lib\"\nlibSDL-1.2.0.so, libSDL-1.2.so.0, libSDL-1.2.so, libSDL.so\nother rules stay as they are. (lib_paths + share_ext)\non WIN32: no lib prefix and try versions.\nSDL-1-2-0.dll, SDL-1-2.dll, SDL-1.2.0.dll, SDL-1.2.dll, SDL.dll\non cygwin: cyg prefix and try versions with '.' and '-'.\ncygSDL-1.2.dll, cygSDL-1.2.0.dll, cygSDL-1-2-0.dll, cygSDL-1-2.dll\n\nAll the pir's for the latest packaged libraries are fixed with RT#51328.\n\nRT#51328 also applies the addional lib =\u003e cyg dll logic, but does not \nhelp with versioned dll's, as for ncurses and SDL most prominently.\n\nExamples what we want to avoid:\n\nloadlib $P1, 'libform'\n+if $P1 goto has_lib\n+loadlib $P1, 'cygform-8'\n+has_lib:\n\nloadlib $P1, 'libncurses'\n+if $P1 goto has_lib1\n+loadlib $P1, 'cygncurses-8'\n+has_lib1:\n# third try\n\nloadlib libsdl, 'libSDL-1.2.so.0'\n- loadlib libsdl, 'cygSDL-1-2-0'\n- $I0 = typeof libsdl\n- if $I0 != .Undef goto OK\n\nloadlib image_lib, 'libSDL_image-1.2.so.0'\n$I0 = typeof image_lib\nif $I0 != .Undef goto OK_HINT2\n- loadlib image_lib, 'cygSDL_image-1-2-0'\n- $I0 = typeof image_lib\n- if $I0 != .Undef goto OK\n  +\n\nSee also other ffi's, such as cffi, how they do deal or not with this \nproblem. Years ago I wrote an overview at \n## http://autocad.xarch.at/lisp/ffis.html\n\nReini Urban\nhttp://phpwiki.org/ http://murbreak.at/\nhttp://helsinki.at/ http://spacemovie.mur.at/\n\nOriginally http://trac.parrot.org/parrot/ticket/1155","files":null}]}