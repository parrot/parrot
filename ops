{"version":1,"ops":[{"type":1,"author":{"id":"74bf5b369ba601db5534b6a77d32aaccc8876d4b"},"timestamp":1310637126,"metadata":{"github-id":"MDU6SXNzdWUyODQ4NjYz","github-url":"https://github.com/parrot/parrot/issues/456","origin":"github"},"title":"Memory leak in compile_file functions","message":"```\n$ valgrind --leak-check=full ./parrot t/compilers/tge/basic.t \n==29055== Memcheck, a memory error detector\n==29055== Copyright (C) 2002-2010, and GNU GPL'd, by Julian Seward et al.\n==29055== Using Valgrind-3.6.1 and LibVEX; rerun with -h for copyright info\n==29055== Command: ./parrot t/compilers/tge/basic.t\n==29055== \n1..11\nok 1 - build up a basic rule in a grammar\nok 2 - build up a basic rule in a grammar\nok 3 - build up a basic rule in a grammar\nok 4 - agid hash\nok 5 - agid hash\nok 6 - agid hash\nok 7 - agid hash\nok 8 - agid hash\nok 9 - agid hash\nok 10 - agid hash\nok 11 - \"Malformed string\" in r11890 under Linux i386\n==29055== \n==29055== HEAP SUMMARY:\n==29055==     in use at exit: 2,439,605 bytes in 6,345 blocks\n==29055==   total heap usage: 12,953 allocs, 6,608 frees, 2,790,512 bytes allocated\n==29055== \n==29055== 2,044 (12 direct, 2,032 indirect) bytes in 1 blocks are definitely lost in loss record 918 of 1,129\n==29055==    at 0x4023796: calloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)\n==29055==    by 0x410CA3B: gc_gms_allocate_memory_chunk_zeroed (gc_gms.c:1854)\n==29055==    by 0x4102D57: Parrot_gc_allocate_memory_chunk_with_interior_pointers (api.c:667)\n==29055==    by 0x4268E26: e_pbc_open (pbc.c:455)\n==29055==    by 0x425F587: emit_open (instructions.c:671)\n==29055==    by 0x425953D: imcc_compile_buffer_safe (imcc.l:1370)\n==29055==    by 0x425AF27: imcc_run_compilation_internal (main.c:574)\n==29055==    by 0x425AD63: imcc_run_compilation_reentrant (main.c:527)\n==29055==    by 0x425ACC6: imcc_compile_file (main.c:504)\n==29055==    by 0x41F5E7B: Parrot_IMCCompiler_nci_compile_file (imccompiler.c:372)\n==29055==    by 0x41FD24E: Parrot_NativePCCMethod_invoke (nativepccmethod.c:124)\n==29055==    by 0x4117888: Parrot_pcc_invoke_from_sig_object (pcc.c:329)\n==29055== \n==29055== 4,589 (12 direct, 4,577 indirect) bytes in 1 blocks are definitely lost in loss record 1,069 of 1,129\n==29055==    at 0x4023796: calloc (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)\n==29055==    by 0x410CA3B: gc_gms_allocate_memory_chunk_zeroed (gc_gms.c:1854)\n==29055==    by 0x4102D57: Parrot_gc_allocate_memory_chunk_with_interior_pointers (api.c:667)\n==29055==    by 0x4268E26: e_pbc_open (pbc.c:455)\n==29055==    by 0x425F587: emit_open (instructions.c:671)\n==29055==    by 0x425953D: imcc_compile_buffer_safe (imcc.l:1370)\n==29055==    by 0x425AF27: imcc_run_compilation_internal (main.c:574)\n==29055==    by 0x425AD63: imcc_run_compilation_reentrant (main.c:527)\n==29055==    by 0x425ACC6: imcc_compile_file (main.c:504)\n==29055==    by 0x411D6A5: Parrot_compile_file (inter_misc.c:243)\n==29055==    by 0x4156E87: compile_file (api.c:1983)\n==29055==    by 0x4157858: Parrot_load_bytecode (api.c:2218)\n==29055== \n==29055== LEAK SUMMARY:\n==29055==    definitely lost: 24 bytes in 2 blocks\n==29055==    indirectly lost: 6,609 bytes in 140 blocks\n==29055==      possibly lost: 0 bytes in 0 blocks\n==29055==    still reachable: 2,432,972 bytes in 6,203 blocks\n==29055==         suppressed: 0 bytes in 0 blocks\n==29055== Reachable blocks (those to which a pointer was found) are not shown.\n==29055== To see them, rerun with: --leak-check=full --show-reachable=yes\n==29055== \n==29055== For counts of detected and suppressed errors, rerun with: -v\n==29055== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 37 from 8)\n```\n\nThe mem leak happens in\n\n```\ne_pbc_open(pbc.c:455): imcc-\u003eglobals = mem_gc_allocate_zeroed_typed(imcc-\u003einterp, imcc_globals);\n```\n\nOriginally http://trac.parrot.org/parrot/ticket/2153","files":null}]}