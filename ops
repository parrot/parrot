{"version":1,"ops":[{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327522613,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NTgxNjI=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3658162"},"message":"The Null PMC is happening at the line:\n\n```\n  interp.'hll_map'(core_int, tclint)\n```\n\nThe first lines of hll_map call VTABLE_type on both types, so I'm guessing that the Null PMC is happening in there.\n\n**EDIT:**  Confirmed.  All the tcl\\* variables are null.  Perhaps the way classes are generated from namespaces have changed since partcl was written?","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327546918,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjM2NTU=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3663655"},"message":"I've fixed the Null PMC error, but have not hit the memory corruption issue.  I _suspect_ that d6a0c0f simply uncovered a GC bug, not caused memory corruption.  But having no way to investiate this further, I'm uncertain.","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327552291,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjQyMjg=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3664228"},"message":"I remembered I had a Debian VM hanging around.  Here's what it gives me:\n\n```\n/usr/local/bin/parrot --output=runtime/tcllib.pbc runtime/tcllib.pir\n*** glibc detected *** /usr/local/bin/parrot: malloc(): memory corruption: 0x084dc568 ***\n======= Backtrace: =========\n/lib/i686/cmov/libc.so.6(+0x6b281)[0x413ce281]\n/lib/i686/cmov/libc.so.6(+0x6e085)[0x413d1085]\n/lib/i686/cmov/libc.so.6(__libc_calloc+0xab)[0x413d23fb]\n/usr/local/lib/libparrot.so.4.0.0(mem_sys_allocate_zeroed+0x2c)[0x400f534c]\n/usr/local/lib/libparrot.so.4.0.0(imcc_new+0x52)[0x40252dd2]\n/usr/local/lib/libparrot.so.4.0.0(+0x1cc910)[0x401ec910]\n/usr/local/lib/libparrot.so.4.0.0(+0x1cbf9b)[0x401ebf9b]\n/usr/local/lib/libparrot.so.4.0.0(Parrot_pmc_new_init_int+0x107)[0x40137f67]\n/usr/local/lib/libparrot.so.4.0.0(+0x24a3aa)[0x4026a3aa]\n/usr/local/lib/libparrot.so.4.0.0(imcc_get_pir_compreg_api+0x10a)[0x4026a0fa]\n/usr/local/bin/parrot[0x80492a1]\n/usr/local/bin/parrot[0x80491a7]\n/lib/i686/cmov/libc.so.6(__libc_start_main+0xe6)[0x41379c76]\n/usr/local/bin/parrot[0x8048f41]\n======= Memory map: ========\n08048000-08054000 r-xp 00000000 08:01 2112       /usr/local/stow/parrot/bin/parrot\n08054000-08055000 rw-p 0000c000 08:01 2112       /usr/local/stow/parrot/bin/parrot\n0844a000-084ef000 rw-p 00000000 00:00 0          [heap]\n40000000-4001b000 r-xp 00000000 08:01 8200       /lib/ld-2.11.2.so\n4001b000-4001c000 r--p 0001a000 08:01 8200       /lib/ld-2.11.2.so\n4001c000-4001d000 rw-p 0001b000 08:01 8200       /lib/ld-2.11.2.so\n4001d000-4001e000 r-xp 00000000 00:00 0          [vdso]\n4001e000-40020000 rw-p 00000000 00:00 0 \n40020000-4030c000 r-xp 00000000 08:01 2103       /usr/local/stow/parrot/lib/libparrot.so.4.0.0\n4030c000-40365000 rw-p 002eb000 08:01 2103       /usr/local/stow/parrot/lib/libparrot.so.4.0.0\n40365000-40366000 rw-p 00000000 00:00 0 \n4036b000-4036d000 r-xp 00000000 08:01 17209      /lib/i686/cmov/libdl-2.11.2.so\n4036d000-4036e000 r--p 00001000 08:01 17209      /lib/i686/cmov/libdl-2.11.2.so\n4036e000-4036f000 rw-p 00002000 08:01 17209      /lib/i686/cmov/libdl-2.11.2.so\n4036f000-40370000 rw-p 00000000 00:00 0 \n40370000-40394000 r-xp 00000000 08:01 17201      /lib/i686/cmov/libm-2.11.2.so\n40394000-40395000 r--p 00023000 08:01 17201      /lib/i686/cmov/libm-2.11.2.so\n40395000-40396000 rw-p 00024000 08:01 17201      /lib/i686/cmov/libm-2.11.2.so\n40396000-404c3000 r-xp 00000000 08:01 35525      /usr/lib/libicuuc.so.44.1\n404c3000-404cd000 rw-p 0012c000 08:01 35525      /usr/lib/libicuuc.so.44.1\n404cd000-404d0000 rw-p 00000000 00:00 0 \n404d0000-4130d000 r--p 00000000 08:01 35528      /usr/lib/libicudata.so.44.1\n4130d000-4130e000 rw-p 00e3c000 08:01 35528      /usr/lib/libicudata.so.44.1\n4130e000-41323000 r-xp 00000000 08:01 17206      /lib/i686/cmov/libpthread-2.11.2.so\n41323000-41324000 r--p 00014000 08:01 17206      /lib/i686/cmov/libpthread-2.11.2.so\n41324000-41325000 rw-p 00015000 08:01 17206      /lib/i686/cmov/libpthread-2.11.2.so\n41325000-41327000 rw-p 00000000 00:00 0 \n41327000-41330000 r-xp 00000000 08:01 17199      /lib/i686/cmov/libcrypt-2.11.2.so\n41330000-41331000 r--p 00008000 08:01 17199      /lib/i686/cmov/libcrypt-2.11.2.so\n41331000-41332000 rw-p 00009000 08:01 17199      /lib/i686/cmov/libcrypt-2.11.2.so\n41332000-4135a000 rw-p 00000000 00:00 0 \n4135a000-41361000 r-xp 00000000 08:01 17207      /lib/i686/cmov/librt-2.11.2.so\n41361000-41362000 r--p 00006000 08:01 17207      /lib/i686/cmov/librt-2.11.2.so\n41362000-41363000 rw-p 00007000 08:01 17207      /lib/i686/cmov/librt-2.11.2.so\n41363000-414a3000 r-xp 00000000 08:01 17217      /lib/i686/cmov/libc-2.11.2.so\n414a3000-414a5000 r--p 0013f000 08:01 17217      /lib/i686/cmov/libc-2.11.2.so\n414a5000-414a6000 rw-p 00141000 08:01 17217      /lib/i686/cmov/libc-2.11.2.so\n414a6000-414a9000 rw-p 00000000 00:00 0 \n414a9000-41592000 r-xp 00000000 08:01 33615      /usr/lib/libstdc++.so.6.0.13\n41592000-41596000 r--p 000e9000 08:01 33615      /usr/lib/libstdc++.so.6.0.13\n41596000-41597000 rw-p 000ed000 08:01 33615      /usr/lib/libstdc++.so.6.0.13\n41597000-4159e000 rw-p 00000000 00:00 0 \n4159e000-415bb000 r-xp 00000000 08:01 8202       /lib/libgcc_s.so.1\n415bb000-415bc000 rw-p 0001c000 08:01 8202       /lib/libgcc_s.so.1\n415bc000-415df000 rw-p 00000000 00:00 0 \n415df000-41754000 r--p 00000000 08:01 68569      /usr/lib/locale/locale-archive\n41800000-41821000 rw-p 00000000 00:00 0 \n41821000-41900000 ---p 00000000 00:00 0 \nbf972000-bf987000 rw-p 00000000 00:00 0          [stack]\nmake: *** [runtime/tcllib.pbc] Aborted\n```","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327553580,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjQzODc=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3664387"},"message":"So the interesting bit is the backtrace.  I've reversed engineered the functions and souce locations involved.  I was wrong about GC, as this is happening before entering the interpreter proper.\n\n\u003ctable\u003e\n\u003ctr\u003e\u003cth\u003eBinary\u003c/th\u003e\u003cth\u003efunction\u003c/th\u003e\u003cth\u003esource\u003c/th\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003emem_sys_allocate_zeroed\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003eimcc_new\u003c/td\u003e  \u003ctd\u003ecompilers/imcc/main.c:141\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003eIMCCompiler.init_int\u003c/td\u003e  \u003ctd\u003esrc/pmc/imccompiler.pmc:115\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003e???\u003c/td\u003e  \u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003eParrot_pmc_new_init_int\u003c/td\u003e  \u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003eget_compreg_pmc\u003c/td\u003e  \u003ctd\u003ecompilers/imcc/api.c:142\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibparrot\u003c/td\u003e  \u003ctd\u003eimcc_get_pir_compreg_api\u003c/td\u003e  \u003ctd\u003ecompilers/imcc/api.c:93\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003eparrot\u003c/td\u003e  \u003ctd\u003esetup_imcc\u003c/td\u003e  \u003ctd\u003efrontend/parrot2/main.c:198\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003eparrot\u003c/td\u003e  \u003ctd\u003emain\u003c/td\u003e  \u003ctd\u003efrontent/parrot2/main.c:164\u003c/td\u003e\u003c/tr\u003e\n\u003ctr\u003e\u003ctd\u003elibc\u003c/td\u003e  \u003ctd\u003e__libc_start_main\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\n\u003c/table\u003e","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327555089,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjQ1MTk=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3664519"},"message":"Triggered same corruption with parrot --output=blah.pbc config_lib.pir\n\nHere's what I think is happening in parseflags()\n1. argc = 3, argv = ['/usr/local/bin/parrot', '--output=runtime/tcllib.pbc', 'runtime/tcllib.pir']\n2. nargs = 0, pargs = [NULL, NULL, NULL]  l. 554-556\n3. nargs = 1, pargs = ['/usr/local/bin/parrot', NULL, NULL] l. 566\n4. longopt_get returns opt = { id: 'o', arg: 'runtime/tcllib.pbc' } l. 568\n5. nargs = 3, pargs = ['/usr/local/bin/parrot', '-o', 'runtime/tcllib.pbc'] l. 623-624\n6. attempts to copy the rest of the args:\n   i = 2, argc = 3\n   nargs = 4, pargs = ['/usr/local/bin/parrot', '-o', 'runtime/tcllib.pbc'] 'runtime/tcllib.pir'  OOPS!\n\nThe code never accounted for attached args.  :-(  I'm going to try a quick fix locally.\n\n**Update:** 03b3d5f should fix this bug.  I'm going to leave it open until Coke can test.","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1327585937,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NjkwOTg=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3669098"},"message":"Verified, this fixes the issue. I would ask we add a test so this doesn't come back during the next refactor.","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1327598760,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM2NzI2OTg=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-3672698"},"message":"The PARROT_ASSERT statement added in 03b3d5f is to ensure that this array doesn't get overrun again.  I'll see if/how we test command line arguments though.","files":null},{"type":3,"author":{"id":"aef4977f5ea786238d7c9581a2f192f4adc3f39d"},"timestamp":1336571974,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU2MDA2ODc=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-5600687"},"message":"@Benabik, @coke: is this issue really fixed? Can we close this ticket now?","files":null},{"type":3,"author":{"id":"646f0669ead6eaf64196bebf3884a5eff162357a"},"timestamp":1336577292,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU2MDI4MjI=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-5602822"},"message":"I'm fine with closing it.  I got distracted by testing, which led to my `gh346` branch.","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1337274024,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU3Njg1MjY=","github-url":"https://github.com/parrot/parrot/issues/185#issuecomment-5768526"},"message":"Closing.","files":null},{"type":4,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1337274024,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTU2OTgyNTI="},"status":2}]}