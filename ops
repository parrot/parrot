{"version":1,"ops":[{"type":3,"author":{"id":"706711d858eacb6e738953240a342cd61b1a57d9"},"timestamp":1293044974,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5Nzg=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503978"},"message":"1374 byte attachment from bluescreen10\nat http://trac.parrot.org/parrot/raw-attachment/ticket/1765/tt1765.patch\n\n```diff --git a/src/gc/alloc_memory.c b/src/gc/alloc_memory.c\nindex 908e5d3..b63e393 100644\n--- a/src/gc/alloc_memory.c\n+++ b/src/gc/alloc_memory.c\n@@ -56,8 +56,10 @@ mem_sys_allocate(size_t size)\n #ifdef DETAIL_MEMORY_DEBUG\n     fprintf(stderr, \"Allocated %i at %p\\n\", size, ptr);\n #endif\n-    if (!ptr \u0026\u0026 size)\n-    if (!ptr \u0026\u0026 size) {\n-        free(ptr);\n       PANIC_OUT_OF_MEM(size);\n-    }\n   return ptr;\n  }\n\n@@ -83,8 +85,10 @@ mem_sys_allocate_zeroed(size_t size)\n #ifdef DETAIL_MEMORY_DEBUG\n     fprintf(stderr, \"Allocated %i at %p\\n\", size, ptr);\n #endif\n-    if (!ptr \u0026\u0026 size)\n-    if (!ptr \u0026\u0026 size) {\n-        free(ptr);\n       PANIC_OUT_OF_MEM(size);\n-    }\n   return ptr;\n  }\n\n@@ -118,8 +122,10 @@ mem_sys_realloc(ARGFREE(void *from), size_t size)\n #ifdef DETAIL_MEMORY_DEBUG\n     fprintf(stderr, \"Allocated %i at %p\\n\", size, ptr);\n #endif\n-    if (!ptr \u0026\u0026 size)\n-    if (!ptr \u0026\u0026 size) {\n-        free(ptr);\n       PANIC_OUT_OF_MEM(size);\n-    }\n   return ptr;\n  }\n\n@@ -151,8 +157,10 @@ mem_sys_realloc_zeroed(ARGFREE(void *from), size_t size, size_t old_size)\n #ifdef DETAIL_MEMORY_DEBUG\n     fprintf(stderr, \"Allocated %i at %p\\n\", size, ptr);\n #endif\n-    if (!ptr \u0026\u0026 size)\n-    if (!ptr \u0026\u0026 size) {\n-        free(ptr);\n       PANIC_OUT_OF_MEM(size);\n-    }\n  \n   if (size \u003e old_size)\n       memset((char*)ptr + old_size, 0, size - old_size);\n\n```\n```","files":null},{"type":3,"author":{"id":"706711d858eacb6e738953240a342cd61b1a57d9"},"timestamp":1293066574,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5Nzk=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503979"},"message":"\u003cp\u003e\nPossible patch\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"706711d858eacb6e738953240a342cd61b1a57d9"},"timestamp":1293067062,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODA=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503980"},"message":"\u003cp\u003e\nafter applying the patch:\u003cbr /\u003e\n\u003cbr /\u003e\n==5367== LEAK SUMMARY:\u003cbr /\u003e\n==5367==    definitely lost: 0 bytes in 0 blocks\u003cbr /\u003e\n==5367==    indirectly lost: 0 bytes in 0 blocks\u003cbr /\u003e\n==5367==      possibly lost: 464,968 bytes in 409 blocks\u003cbr /\u003e\n==5367==    still reachable: 589,192 bytes in 180 blocks\u003cbr /\u003e\n==5367==         suppressed: 0 bytes in 0 blocks\u003cbr /\u003e\n==5367== Reachable blocks (those to which a pointer was found) are not shown.\u003cbr /\u003e\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"18879c4084549ff2c7022dc058bcf4940fadd0f2"},"timestamp":1293068322,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODE=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503981"},"message":"\u003cp\u003e\nI don't see how freeing a NULL pointer could fix the memory leak. I just tested Parrot trunk without the patch and I don't see the memory leak anymore. There is another GC-related one though.\n\u003c/p\u003e\n\n\u003cp\u003e\nFor some IRC discussion on this issue, see \u003ca   href=\"http://irclog.perlgeek.de/parrot/2010-09-01#i_2773493\"\u003e\u003cspan class=\"icon\"\u003eÂ \u003c/span\u003ehttp://irclog.perlgeek.de/parrot/2010-09-01#i_2773493\u003c/a\u003e\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"706711d858eacb6e738953240a342cd61b1a57d9"},"timestamp":1293071096,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODI=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503982"},"message":"\u003cp\u003e\nI agree that freeing a null pointer doesn't give you anything. I think its the way valgrind works it just sees that you're not doing anything with a chunk of memory recently allocated - meaning not freeing it, not returning it - for the branch of (!ptr \u0026amp;\u0026amp; size).\n\u003c/p\u003e\n\n\u003cp\u003e\nWithout the patch I was able to reproduce your original report in which valgrind reported \"definitely lost\" blocks.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"706711d858eacb6e738953240a342cd61b1a57d9"},"timestamp":1293071281,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODM=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503983"},"message":"\u003cp\u003e\nWithout the patch:\u003cbr /\u003e\n\u003cbr /\u003e\n==26151== LEAK SUMMARY:\u003cbr /\u003e\n==26151==    definitely lost: 112 bytes in 2 blocks\u003cbr /\u003e\n==26151==    indirectly lost: 0 bytes in 0 blocks\u003cbr /\u003e\n==26151==      possibly lost: 1,683,384 bytes in 1,010 blocks\u003cbr /\u003e\n==26151==    still reachable: 157,448 bytes in 122 blocks\u003cbr /\u003e\n==26151==         suppressed: 0 bytes in 0 blocks\u003cbr /\u003e\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"18879c4084549ff2c7022dc058bcf4940fadd0f2"},"timestamp":1293080917,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODQ=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503984"},"message":"\u003cp\u003e\nI can't reproduce this particular leak anymore. Another one in the string GC code showed up, but that's fixed in db189b22.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"18879c4084549ff2c7022dc058bcf4940fadd0f2"},"timestamp":1293358038,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODU=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503985"},"message":"\u003cp\u003e\nThe leak can be reproduced with the --leak-test option. Description updated.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1314490853,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM5ODY=","github-url":"https://github.com/parrot/parrot/issues/678#issuecomment-3503986"},"message":"\u003cp\u003e\nReplying to \u003ca href=\"http://trac.parrot.org/parrot/ticket/1765#comment:8\" title=\"Comment 8 for Ticket #1765\"\u003enwellnhof\u003c/a\u003e:\n\u003c/p\u003e\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n The leak can be reproduced with the --leak-test option. Description updated.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nCan we get an update on the status of this ticket?\n\u003c/p\u003e\n\n\u003cp\u003e\nThank you very much.\n\u003c/p\u003e\n\n\u003cp\u003e\nkid51\n\u003c/p\u003e","files":null},{"type":4,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1413797607,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTgwNzM0NTAy"},"status":2}]}