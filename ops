{"version":1,"ops":[{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1240582194,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM2NjA=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-3503660"},"message":"3747 byte attachment from joernc\nat http://trac.parrot.org/parrot/raw-attachment/ticket/579/solbug.txt\n\n```Summary: build failure on Solaris/x86 with GCC and native assembler\n\n## Reported by: joernc@gmail.com\n\nsrc/ops/experimental.ops tests for the compiler to choose appropriate\nassembler code:\n\n#if defined(**GNUC**) \u0026\u0026 defined(i386)\n    **asm**(\"int3\");       /\\* opcode 0xcc */\n#endif\n\nThis fails e.g. on Solaris, when using GCC with the native assembler\n/usr/ccs/bin/as.\n\nThis change\n\n--- src/ops/experimental.ops    2009/04/24 11:33:01     1.1\n+++ src/ops/experimental.ops    2009/04/24 11:33:17\n@@ -45,7 +45,7 @@\n =cut\n\n op trap() :deprecated {\n-#if defined(**GNUC**) \u0026\u0026 defined(i386)\n+#if defined(**GNUC**) \u0026\u0026 defined(i386) \u0026\u0026 !defined(**sun**)\n     **asm**(\"int3\");       /\\* opcode 0xcc */\n #endif\n #if defined(**GNUC**) \u0026\u0026 defined(PPC)\n\ndoes the trick for me, but may not work then using gas. How to implement\nthe real fix (i.e. checking for the assembler, not the compiler in the\nfirst place) is unknown to me.\n\nAs this file defines experimental opcodes, that are \"implicitly deprecated\",\nhow about adding a configure flag to switch them off (or switch them off\nby default and add a flag to turn them on when needed) in Configure.pl?\n\n---\n\nosname= solaris\nosvers= 2.10\narch=   i86pc-solaris-64int\n\n## cc=     cc\n\nFlags:\n    category=install\n    severity=medium\n\n##     ack=no\n\nSummary of my parrot 1.1.0 (r0) configuration:\n  configdate='Fri Apr 24 11:16:30 2009 GMT'\n  Platform:\n    osname=solaris, archname=i386-solaris-thread-multi\n    jitcapable=1, jitarchname=i386-solaris,\n    jitosname=SOLARIS, jitcpuarch=i386\n    execcapable=0\n    perl=perl\n  Compiler:\n    cc='gcc', ccflags='-D_REENTRANT  -pipe -I/usr/pkgsrc/20090421/include  -DHASATTRIBUTE_CONST  -DHASATTRIBUTE_DEPRECATED  -DHASATTRIBUTE_MALLOC  -DHASATTRIBUTE_NONNULL  -DHASATTRIBUTE_NORETURN  -DHASATTRIBUTE_PURE  -DHASATTRIBUTE_UNUSED  -DHASATTRIBUTE_WARN_UNUSED_RESULT  -falign-functions=16 -funit-at-a-time -maccumulate-outgoing-args -W -Wall -Waggregate-return -Wcast-align -Wcast-qual -Wchar-subscripts -Wcomment -Wdisabled-optimization -Wendif-labels -Wextra -Wformat -Wformat-extra-args -Wformat-nonliteral -Wformat-security -Wformat-y2k -Wimplicit -Wimport -Winit-self -Winline -Winvalid-pch -Wmissing-braces -Wno-missing-format-attribute -Wpacked -Wparentheses -Wpointer-arith -Wreturn-type -Wsequence-point -Wno-shadow -Wsign-compare -Wstrict-aliasing -Wstrict-aliasing=2 -Wswitch -Wswitch-default -Wtrigraphs -Wundef -Wunknown-pragmas -Wno-unused -Wwrite-strings -Wbad-function-cast -Wdeclaration-after-statement -Wimplicit-function-declaration -Wimplicit-int -Wmain -Wmissing-declarations -Wmissing-prototypes -Wnested-externs -Wnonnull -DHAS_GETTEXT',\n  Linker and Libraries:\n    ld='gcc', ldflags='-Wl,-R/usr/pkgsrc/20090421/lib  -L/usr/pkgsrc/20090421/lib',\n    cc_ldflags='',\n    libs='-lm -ldl -lsocket -lnsl -lpthread -lrt -lreadline -lintl'\n  Dynamic Linking:\n    share_ext='.so', ld_share_flags='-Wl,-R/usr/pkgsrc/20090421/lib -G -L/usr/pkgsrc/20090421/lib',\n    load_ext='.so', ld_load_flags='-Wl,-R/usr/pkgsrc/20090421/lib -G -L/usr/pkgsrc/20090421/lib'\n  Types:\n    iv=long, intvalsize=4, intsize=4, opcode_t=long, opcode_t_size=4,\n    ptrsize=4, ptr_alignment=1 byteorder=1234, \n    nv=double, numvalsize=8, doublesize=8, longdoublesize=12\n\n---\n\nEnvironment:\n    HOME =/home/joern\n    LANG  (unset)\n    LANGUAGE  (unset)\n    LC_CTYPE =en_US.ISO8859-1\n    LC_MESSAGES =C\n    LC_MONETARY =en_US.ISO8859-1\n    LC_NUMERIC =en_US.ISO8859-1\n    LC_TIME =en_US.ISO8859-1\n    LD_LIBRARY_PATH  (unset)\n    LOGDIR  (unset)\n    PATH =/usr/pkgsrc/head/bin:/usr/pkgsrc/head/sbin:/usr/pkgsrc/head/gcc34/bin:/usr/bin:/usr/sbin:/usr/openwin/bin:/usr/dt/bin:/usr/ccs/bin\n    PERLLIB =/home/joern/perl/lib/perl5:/home/joern/perl/lib/perl5/site_perl/5.8.0\n    SHELL =/bin/tcsh\n\n```\n```","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1240605872,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM2NjE=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-3503661"},"message":"\u003cp\u003e\nOP posted everything as an attachment, including comments.\n\u003c/p\u003e\n\n\u003cp\u003e\ntrap is actually scheduled for deletion; We can probably resolve this issue by finalizing that removal.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1240606350,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM2NjI=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-3503662"},"message":"Trac commenter: joernc\n\n\u003cblockquote class=\"citation\"\u003e\n\u003cp\u003e\n OP posted everything as an attachment, including comments.\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\nThat's how I understood the instructions given by parrot_bug. The section \"How To Submit A Bug Report\" in docs/submissions.pod could elaborate on this some more as well.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"d9b4aee65ce8c18d4a43eced1eecb0d154e1eebb"},"timestamp":1295087120,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM2NjM=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-3503663"},"message":"\u003cp\u003e\nIn order to address the issue raised in this ticket, I'm going to pull what should have been the Description out of the attachment and re-post it here.  Is there someone on Solaris/x86 who could look into this issue?\n\u003c/p\u003e\n\n\u003cp\u003e\nThank you very much.\n\u003c/p\u003e\n\n\u003cp\u003e\nkid51\n\u003c/p\u003e\n\n\u003cp\u003e\n### Original ###\n\u003c/p\u003e\n\n\u003cp\u003e\n\u003ci\u003esrc/ops/experimental.ops\u003c/i\u003e tests for the compiler to choose appropriate\nassembler code:\n\u003c/p\u003e\n\n\u003cpre class=\"wiki\"\u003e#if defined(**GNUC**) \u0026amp;\u0026amp; defined(i386)\n    **asm**(\"int3\");       /\\* opcode 0xcc */\n#endif\n\u003c/pre\u003e\u003cp\u003e\nThis fails e.g. on Solaris, when using GCC with the native assembler\n\u003ci\u003e/usr/ccs/bin/as\u003c/i\u003e.\n\u003c/p\u003e\n\n\u003cp\u003e\nThis change\n\u003c/p\u003e\n\n\u003cpre class=\"wiki\"\u003e--- src/ops/experimental.ops    2009/04/24 11:33:01     1.1\n+++ src/ops/experimental.ops    2009/04/24 11:33:17\n@@ -45,7 +45,7 @@\n =cut\n op trap() :deprecated {\n-#if defined(**GNUC**) \u0026amp;\u0026amp; defined(i386)\n+#if defined(**GNUC**) \u0026amp;\u0026amp; defined(i386) \u0026amp;\u0026amp; !defined(**sun**)\n     **asm**(\"int3\");       /\\* opcode 0xcc */\n #endif\n #if defined(**GNUC**) \u0026amp;\u0026amp; defined(PPC)\n\u003c/pre\u003e\u003cp\u003e\ndoes the trick for me, but may not work then using gas. How to implement\nthe real fix (i.e. checking for the assembler, not the compiler in the\nfirst place) is unknown to me.\n\u003c/p\u003e\n\n\u003cp\u003e\nAs this file defines experimental opcodes, that are \"implicitly deprecated\",\nhow about adding a configure flag to switch them off (or switch them off\nby default and add a flag to turn them on when needed) in Configure.pl?\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1295305890,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM2NjQ=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-3503664"},"message":"\u003cp\u003e\nThe analysis is correct.  (That particular combination, gcc with native assembler, is probably not too common on Solaris/x86 these days, so this probably won't appear often.)  A proper fix is, as the original poster stated, to check for which assembler is being used in Configure.pl.  This would also help select the correct assembler syntax for TT \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/271\" title=\"bug: Parrot crashes on openbsd/sparc64 (closed: fixed)\"\u003e#271\u003c/a\u003e (and hence help clean up TT \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/273\" title=\"todo: Fix system-dependent code in src/gc/system.c (closed: wontfix)\"\u003e#273\u003c/a\u003e as well).  More immediately, simply deleting the offending deprecated experimental opcode would eliminate this particular problem.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1347906749,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg2MjU2NDg=","github-url":"https://github.com/parrot/parrot/issues/583#issuecomment-8625648"},"message":"Fixed with 379faba3e871ea9ff0a57611fa4a3bad91b9a6be","files":null},{"type":4,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1347906749,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjQ3ODczMDA="},"status":2}]}