{"version":1,"ops":[{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234350492,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NjI=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502862"},"message":"2399 byte attachment from rurban\nat http://trac.parrot.org/parrot/raw-attachment/ticket/313/tt313-win32-neg0.patch\n\n# ```Index: parrot-svn/t/op/arithmetics.t\n\n--- parrot-svn.orig/t/op/arithmetics.t  2009-01-31 14:05:40.000000000 +0100\n+++ parrot-svn/t/op/arithmetics.t   2009-02-11 09:36:04.671875000 +0100\n@@ -169,10 +169,22 @@\n # Operations on a single NUMVAL\n #\n\n-SKIP: {\n-    skip 'failing on your platform' =\u003e 1 if $^O =~ m/openbsd/i;\n  +my $output = \u003c\u003cOUTPUT;\n  +-0\n  +0\n  +-123.456789\n  +123.456789\n  +-0\n  +0\n  +-123.456789\n  +123.456789\n  +OUTPUT\n  +\n  +if ($^O =~ m/openbsd|win32/i) {\n-    $output =~ s/-0$/0/mg;\n  +}\n\n-pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"turn a native number into its negative\" );\n+pasm_output_is( \u003c\u003c'CODE', $output, \"turn a native number into its negative\" );\n         set N0, 0\n         neg N0\n         print N0\n@@ -208,17 +220,6 @@\n         print \"\\n\"\n         end\n CODE\n--0\n-0\n--123.456789\n-123.456789\n--0\n-0\n--123.456789\n-123.456789\n\n## -OUTPUT\n\n-}\n\n pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"take the absolute of a native number\" );\n         set N0, 0\n\n# Index: parrot-svn/t/pmc/float.t\n\n--- parrot-svn.orig/t/pmc/float.t   2009-01-31 14:05:39.000000000 +0100\n+++ parrot-svn/t/pmc/float.t    2009-02-11 09:41:01.468750000 +0100\n@@ -503,20 +503,18 @@\n ok 2\n OUTPUT\n\n-SKIP: {\n-    skip 'failing on your platform' =\u003e 1 if $^O =~ m/openbsd/i;\n  +my $output = '-0';\n  +if ($^O =~ m/openbsd|win32/i) {\n-    $output =~ s/-0$/0/mg;\n  +}\n\n-pasm_output_like( \u003c\u003c 'CODE', \u003c\u003c 'OUTPUT', \"neg 0\" );\n+pasm_output_is( \u003c\u003c 'CODE', $output, \"neg 0\" );\n     new P0, ['Float']\n     set P0, 0.0\n     neg P0\n         print P0\n     end\n CODE\n-/^-0/\n\n## -OUTPUT\n\n-}\n\n pasm_output_is( \u003c\u003c 'CODE', \u003c\u003c 'OUTPUT', \"Equality\" );\n     new P0, ['Float']\n\n# Index: parrot-svn/t/pmc/complex.t\n\n--- parrot-svn.orig/t/pmc/complex.t 2009-01-31 14:05:39.000000000 +0100\n+++ parrot-svn/t/pmc/complex.t  2009-02-11 09:45:36.421875000 +0100\n@@ -1042,12 +1042,13 @@\n     .complex_op_is(\"-2-3i\", \"3.590565-0.530921i\", 'sinh' )\n\n```\n eq osname, \"openbsd\", fail\n```\n-    eq osname, \"MSWin32\", fail\n   .complex_op_is(\"0-2i\", \"-0.000000-0.909297i\", 'sinh' )\n   .complex_op_is(\"0+2i\", \"-0.000000+0.909297i\", 'sinh' )\n   .return()\n  \n  fail:\n-    skip( 2, 'failing on your platform' )\n-    skip( 2, 'sinh 0+2i, sinh 0-2i failing on your platform' )\n  .end\n  \n  .sub cosh_of_complex_numbers\n\n```\n```","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234372494,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NjM=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502863"},"message":"\u003cp\u003e\nFixed by r36574.\n\u003c/p\u003e\n\n\u003cp\u003e\nSee e.g. for exact the same buildbot failures\n\u003ca   href=\"http://smolder.plusthree.com/app/public_projects/report_details/17922\"\u003e\u003cspan class=\"icon\"\u003e \u003c/span\u003ehttp://smolder.plusthree.com/app/public_projects/report_details/17922\u003c/a\u003e\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"56b030459ff5c3e63b58d71e1bed10897e6a7686"},"timestamp":1234372972,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NjQ=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502864"},"message":"\u003cp\u003e\nNo, you didn't \"fix\" these.  A real fix would make the feature work, and the tests pass.  That's why we have tests -- to give us confidence that features work.\n\u003c/p\u003e\n\n\u003cp\u003e\nSkipping failing tests that should pass is never acceptable.  If you can't make them pass, an acceptable alternative is marking the tests as TODO.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234380839,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NjU=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502865"},"message":"\u003cp\u003e\nchanged by chromatic from skip to todo with r36575.\n\u003c/p\u003e\n\n\u003cp\u003e\nMarked -0.0 tests as TODO instead of failing on MSWin32 and OpenBSD, per comments on TT \u003ca class=\"new ticket\" href=\"http://trac.parrot.org/parrot/ticket/313\" title=\"todo: ignore print -0 test errors on win32 (new)\"\u003e#313\u003c/a\u003e. This reverts and supersedes r36574. review: \u003ca href=\"https://trac.parrot.org/parrot/changeset/36575/\"\u003ehttps://trac.parrot.org/parrot/changeset/36575/\u003c/a\u003e\n\u003c/p\u003e\n\n\u003cp\u003e\nThis ticket will mark the openbsd and win32 workarounds to fix the printout.\nI'll also seperate this case in the tests.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234391266,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NjY=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502866"},"message":"18576 byte attachment from rurban\nat http://trac.parrot.org/parrot/raw-attachment/ticket/313/tt313-add-neg_0.patch\n\n# ```Index: parrot-svn/lib/Parrot/Configure/Step/List.pm\n\n--- parrot-svn.orig/lib/Parrot/Configure/Step/List.pm   2009-01-02 12:48:36.000000000 +0000\n+++ parrot-svn/lib/Parrot/Configure/Step/List.pm    2009-02-11 18:48:35.444625000 +0000\n@@ -50,6 +50,7 @@\n     auto::memalign\n     auto::signal\n     auto::socklen_t\n-    auto::neg_0\n   auto::env\n   auto::gmp\n   auto::readline\n  Index: parrot-svn/t/op/arithmetics.t\n  ===================================================================\n  --- parrot-svn.orig/t/op/arithmetics.t  2009-02-11 17:37:36.913375000 +0000\n  +++ parrot-svn/t/op/arithmetics.t   2009-02-11 18:31:19.100875000 +0000\n  @@ -33,29 +33,23 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"take the negative of a native integer\" );\n         set I0, 0\n         neg I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, 1234567890\n       neg I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, -1234567890\n       neg I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, 0\n       set I1, 0\n       neg I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       set I0, 1234567890\n       neg I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       set I0, -1234567890\n       neg I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       end\n  CODE\n  0\n  @@ -69,29 +63,23 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"take the absolute of a native integer\" );\n         set I0, 0\n         abs I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, 1234567890\n       abs I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, -1234567890\n       abs I0\n-        print I0\n-        print \"\\n\"\n-        say I0\n       set I0, 0\n       set I1, 0\n       abs I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       set I0, 1234567890\n       abs I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       set I0, -1234567890\n       abs I1, I0\n-        print I1\n-        print \"\\n\"\n-        say I1\n       end\n  CODE\n  0\n  @@ -109,11 +97,9 @@\n       set I0, 4000\n       set I1, -123\n       add I2, I0, I1\n-        print I2\n-        print \"\\n\"\n-        say I2\n       add I0, I0, I1\n-        print I0\n-        print \"\\n\"\n-        say I0\n       end\n  CODE\n  3877\n  @@ -124,11 +110,9 @@\n       set I0, 4000\n       set I1, -123\n       sub I2, I0, I1\n-        print I2\n-        print \"\\n\"\n-        say I2\n       sub I0, I0, I1\n-        print I0\n-        print \"\\n\"\n-        say I0\n       end\n  CODE\n  4123\n  @@ -139,11 +123,9 @@\n       set I0, 4000\n       set I1, -123\n       mul I2, I0, I1\n-        print I2\n-        print \"\\n\"\n-        say I2\n       mul I0, I0, I1\n-        print I0\n-        print \"\\n\"\n-        say I0\n       end\n  CODE\n  -492000\n  @@ -154,11 +136,9 @@\n       set I0, 4000\n       set I1, -123\n       div I2, I0, I1\n-        print I2\n-        print \"\\n\"\n-        say I2\n       div I0, I0, I1\n-        print I0\n-        print \"\\n\"\n-        say I0\n       end\n  CODE\n  -32\n  @@ -177,21 +157,23 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, 'negate -0.0', @todo );\n         set N0, 0\n         neg N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, -0.0\n       neg N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, -0.0\n       neg N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n-        set N0, 0\n-        set N1, 1\n-        neg N1, N0\n-        say N1\n- ```\n     end\n  ```\n  \n  CODE\n  -0\n  0\n  --0\n  0\n  +-0\n  OUTPUT\n  \n  }\n  @@ -204,30 +186,20 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, 'negate a native number' );\n         set N0, 123.4567890\n         neg N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, -123.4567890\n       neg N0\n-        print N0\n-        print \"\\n\"\n-        set N0, 0\n-        set N1, 1\n-        neg N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N0\n       set N0, 123.4567890\n       neg N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       set N0, -123.4567890\n       neg N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       end\n  CODE\n  -123.456789\n  123.456789\n  -0\n  -123.456789\n  123.456789\n  OUTPUT\n  @@ -235,40 +207,32 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"take the absolute of a native number\" );\n         set N0, 0\n         abs N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, -0.0\n       abs N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, 123.45678901\n       abs N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, -123.45678901\n       abs N0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, 0\n       set N1, 1\n       abs N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       set N0, 0.0\n       set N1, 1\n       abs N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       set N0, 123.45678901\n       set N1, 1\n       abs N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       set N0, -123.45678901\n       set N1, 1\n       abs N1, N0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       end\n  CODE\n  0\n  @@ -284,56 +248,45 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"ceil of a native number\" );\n        set N0, 0\n        ceil N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, 123.45678901\n      ceil N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, -123.45678901\n      ceil N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, 0\n      set N1, 1\n      ceil N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 0.0\n      set N1, 1\n      ceil N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 123.45678901\n      set N1, 1\n      ceil N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, -123.45678901\n      set N1, 1\n      ceil N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 0\n      set I1, 1\n      ceil I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, 0.0\n      set I1, 1\n      ceil I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, 123.45678901\n      set I1, 1\n      ceil I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, -123.45678901\n      set I1, 1\n      ceil I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      end\n  CODE\n  0\n  @@ -352,56 +305,45 @@\n  pasm_output_is( \u003c\u003c'CODE', \u003c\u003cOUTPUT, \"floor of a native number\" );\n        set N0, 0\n        floor N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, 123.45678901\n      floor N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, -123.45678901\n      floor N0\n-       print N0\n-       print \"\\n\"\n-       say N0\n      set N0, 0\n      set N1, 1\n      floor N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 0.0\n      set N1, 1\n      floor N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 123.45678901\n      set N1, 1\n      floor N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, -123.45678901\n      set N1, 1\n      floor N1, N0\n-       print N1\n-       print \"\\n\"\n-       say N1\n      set N0, 0\n      set I1, 1\n      floor I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, 0.0\n      set I1, 1\n      floor I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, 123.45678901\n      set I1, 1\n      floor I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      set N0, -123.45678901\n      set I1, 1\n      floor I1, N0\n-       print I1\n-       print \"\\n\"\n-       say I1\n      end\n  CODE\n  0\n  @@ -424,14 +366,11 @@\n       set I0, 4000\n       set N0, -123.123\n       add N1, N0, I0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       add N0, N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       add N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  3876.877\n  @@ -443,14 +382,11 @@\n       set I0, 4000\n       set N0, -123.123\n       sub N1, N0, I0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       sub N0, N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       sub N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  -4123.123\n  @@ -462,14 +398,11 @@\n       set I0, 4000\n       set N0, -123.123\n       mul N1, N0, I0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       mul N0, N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       mul N0, -2\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  -492492\n  @@ -481,21 +414,16 @@\n       set I0, 4000\n       set N0, -123.123\n       div N1, N0, I0\n-        print N1\n-        print \"\\n\"\n-        say N1\n       div N0, N0, I0\n-        print N0\n-        print \"\\n\"\n-        say N0\n       div N0, 1\n-        print N0\n-        print \"\\n\"\n-        say N0\n       set N0, 100.000\n       div N0, 100\n-        print N0\n-        print \"\\n\"\n-        say N0\n       div N0, 0.01\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  -0.03078075\n  @@ -512,11 +440,9 @@\n       set N2, 4000.246\n       set N0, -123.123\n       add N1, N0, N2\n-        print N1\n-        print \"\\n\"\n-        say N1\n       add N0, N0, N2\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  3877.123\n  @@ -527,11 +453,9 @@\n       set N2, 4000.246\n       set N0, -123.123\n       sub N1, N0, N2\n-        print N1\n-        print \"\\n\"\n-        say N1\n       sub N0, N0, N2\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  -4123.369\n  @@ -542,11 +466,9 @@\n       set N2, 4000.246\n       set N0, -123.123\n       mul N1, N0, N2\n-        print N1\n-        print \"\\n\"\n-        say N1\n       mul N0, N0, N2\n-        print N0\n-        print \"\\n\"\n-        say N0\n       end\n  CODE\n  -492522.288258\n  @@ -557,11 +479,9 @@\n       set N2, 4000.246\n       set N0, -123.123\n       div N1, N0, N2\n-        print N1\n-        print \"\\n\"\n-        say N1\n       div N0, N0, N2\n-        print N0\n-        print \"\\n\"\n- ```\n     say N0\n   end\n  ```\n  \n  CODE\n  -0.0307788571002883\n  @@ -574,7 +494,7 @@\n       lcm I2, I1, I0\n       eq I2, 10, OK1\n       print \"not \"\n  -OK1:    print \"ok 1\\n\"\n  +OK1:    say \"ok 1\"\n  \n  ```\n   set I1, 17\n   lcm I2, I1, I0\n  ```\n  \n  # Index: parrot-svn/config/auto/neg_0.pm\n  \n  --- parrot-svn.orig/config/auto/neg_0.pm    2009-02-11 17:59:09.000000000 +0000\n  +++ parrot-svn/config/auto/neg_0.pm 2009-02-11 19:02:07.835250000 +0000\n  @@ -1,5 +1,5 @@\n  -# Copyright (C) 2006-2007, The Perl Foundation.\n  -# $Id: neg_0.pm 30367 2008-08-20 02:21:59Z jkeenan $\n  +# Copyright (C) 2009, The Perl Foundation.\n  +# $Id: neg_0.pm 30367 2008-08-20 02:21:59Z rurban $\n  \n  =head1 NAME\n\n@@ -7,7 +7,7 @@\n\n =head1 DESCRIPTION\n\n-Determines whether print -0.0 can print -0 or just 0.\n+Determines whether print -0.0 can print \"-0\" or just prints \"0\"\n\n This needs workarounds on older win32 (msvcrt.dll) and openbsd.\n\n@@ -33,26 +33,30 @@\n\n sub runstep {\n\n##      my ( $self, $conf ) = @_;\n\n## \\-    my $d_negative_zero = _probe_for_negative_zero($conf);\n-    $self-\u003e_evaluate_negative_zero($conf, $d_negative_zero);\n-    my ( $verbose ) = $conf-\u003eoptions-\u003eget('verbose');\n-    $conf-\u003ecc_gen('config/auto/neg_0/test_c.in');\n-    eval { $conf-\u003ecc_build( q{} ); };\n-    my $has_neg_0 = 0;\n-    if ( !$@ ) {\n-        my $test = $conf-\u003ecc_run();\n-        $has_neg_0 = $self-\u003e_evaluate_cc_run($conf, $test, $has_neg_0, $verbose);\n-    }\n-    $conf-\u003ecc_clean();\n-    $conf-\u003edata-\u003eset( has_negative_zero =\u003e $has_neg_0 );\n  \n   return 1;\n  }\n\n-sub _probe_for_negative_zero {\n-    my $conf = shift;\n-    return $conf-\u003edata-\u003eget('has_negative_zero')\n-            ||\n-           $conf-\u003edata-\u003eget_p5('d_negative_zero');\n  -}\n  -\n  -sub _evaluate_negative_zero {\n-    my ($self, $conf, $d_negative_zero) = @_;\n-    my $has_negative_zero = $d_negative_zero ? 1 : 0;\n-    $self-\u003eset_result( $has_negative_zero ? 'yes' : 'no' );\n-    $conf-\u003edata-\u003eset( has_negative_zero =\u003e $has_negative_zero );\n  +sub _evaluate_cc_run {\n-    my $self = shift;\n-    my ($conf, $test, $has_neg_0, $verbose) = @_;\n-    if ( $test =~ m/^-0/ ) {\n-        $has_neg_0 = 1;\n-        $self-\u003eset_result( $has_neg_0 ? 'yes' : 'no' );\n-        $conf-\u003edata-\u003eset( has_negative_zero =\u003e $has_neg_0 );\n-        print \" (yes) \" if $verbose;\n-    }\n-    return $has_neg_0;\n  }\n  \n  1;\n  \n  # Index: parrot-svn/t/steps/auto_neg_0-01.t\n  \n  --- /dev/null   1970-01-01 00:00:00.000000000 +0000\n  +++ parrot-svn/t/steps/auto_neg_0-01.t  2009-02-11 19:46:30.382125000 +0000\n  @@ -0,0 +1,106 @@\n  +#! perl\n  +# Copyright (C) 2009, The Perl Foundation.\n  +# $Id: auto_socklen_t-01.t 30640 2008-08-29 23:09:28Z jkeenan $\n  +# auto_neg_0-01.t\n  +\n  +use strict;\n  +use warnings;\n  +use Test::More tests =\u003e 16;\n  +use Carp;\n  +use lib qw( lib t/configure/testlib );\n  +use_ok('config::auto::socklen_t');\n  +use Parrot::Configure;\n  +use Parrot::Configure::Options qw( process_options );\n  +use Parrot::Configure::Test qw(\n-    test_step_thru_runstep\n-    rerun_defaults_for_testing\n-    test_step_constructor_and_description\n  +);\n  +use IO::CaptureOutput qw| capture |;\n  +\n  +########### regular ###########\n  +\n  +my ($args, $step_list_ref) = process_options(\n-    {\n-        argv =\u003e [ ],\n-        mode =\u003e q{configure},\n-    }\n  +);\n  +\n  +my $conf = Parrot::Configure-\u003enew;\n  +\n  +my $pkg = q{auto::neg_0};\n  +\n  +$conf-\u003eadd_steps($pkg);\n  +\n  +my $serialized = $conf-\u003epcfreeze();\n  +\n  +$conf-\u003eoptions-\u003eset( %{$args} );\n  +my $step = test_step_constructor_and_description($conf);\n  +my $ret = $step-\u003erunstep($conf);\n  +ok( $ret, \"runstep() returned true value\" );\n  +ok(defined($step-\u003eresult()), \"A result has been defiined\");\n  +\n  +$conf-\u003ereplenish($serialized);\n  +\n  +##### _evaluate_neg_0_t() #####\n  +\n  +($args, $step_list_ref) = process_options(\n-    {\n-        argv =\u003e [ ],\n-        mode =\u003e q{configure},\n-    }\n  +);\n  +$conf-\u003eoptions-\u003eset( %{$args} );\n  +$step = test_step_constructor_and_description($conf);\n  +\n  +my $d_neg_zero;\n  +\n  +$d_neg_zero = q{-0};\n  +ok($step-\u003e_evaluate_cc_run($conf, $d_neg_zero),\n-    \"_evaluate_cc_run() completed satisfactorily\");\n  +is($step-\u003eresult(), q{yes}, \"Got expected result\");\n  +is($conf-\u003edata-\u003eget('has_negative_zero'), 1,\n-    \"has_negative_zero set as expected\");\n  +\n  +$d_neg_zero = q{0};\n  +ok($step-\u003e_evaluate_cc_run($conf, $d_neg_zero),\n-    \"_evaluate_cc_run() completed satisfactorily\");\n  +is($step-\u003eresult(), q{no}, \"Got expected result\");\n  +is($conf-\u003edata-\u003eget('has_negative_zero'), 0,\n-    \"has_negative_zero set as expected\");\n  +\n  +pass(\"Completed all tests in $0\");\n  +\n  +################### DOCUMENTATION ###################\n  +\n  +=head1 NAME\n  +\n  +auto_neg_0-01.t - test auto::neg_0\n  +\n  +=head1 SYNOPSIS\n  +\n-    % prove t/steps/auto_neg_0-01.t\n  +\n  +=head1 DESCRIPTION\n  +\n  +The files in this directory test functionality used by F\u003cConfigure.pl\u003e.\n  +\n  +The tests in this file test auto::neg_0.\n  +\n  +=head1 AUTHOR\n  +\n  +Reini Urban\n  +\n  +=head1 SEE ALSO\n  +\n  +config::auto::neg_0, F\u003cConfigure.pl\u003e.\n  +\n  +=cut\n  +\n  +# Local Variables:\n  +#   mode: cperl\n  +#   cperl-indent-level: 4\n  +#   fill-column: 100\n  +# End:\n  +# vim: expandtab shiftwidth=4:\n  Index: parrot-svn/MANIFEST\n  ===================================================================\n  --- parrot-svn.orig/MANIFEST    2009-02-11 11:09:51.000000000 +0000\n  +++ parrot-svn/MANIFEST 2009-02-11 19:20:21.725875000 +0000\n  @@ -273,6 +273,8 @@\n  config/auto/memalign/test_c.in                              []\n  config/auto/msvc.pm                                         []\n  config/auto/msvc/test_c.in                                  []\n  +config/auto/neg_0.pm                                        []\n  +config/auto/neg_0/test_c.in                                 []\n  config/auto/opengl.pm                                       []\n  config/auto/opengl/opengl_c.in                              []\n  config/auto/ops.pm                                          []\n  @@ -3247,6 +3249,7 @@\n  t/steps/auto_macports-02.t                                  []\n  t/steps/auto_memalign-01.t                                  []\n  t/steps/auto_msvc-01.t                                      []\n  +t/steps/auto_neg_0-01.t                                     []\n  t/steps/auto_opengl-01.t                                    []\n  t/steps/auto_ops-01.t                                       []\n  t/steps/auto_pcre-01.t                                      []\n  Index: parrot-svn/config/auto/neg_0/test_c.in\n  ===================================================================\n  --- /dev/null   1970-01-01 00:00:00.000000000 +0000\n  +++ parrot-svn/config/auto/neg_0/test_c.in  2009-02-11 18:18:18.038375000 +0000\n  @@ -0,0 +1,8 @@\n  +#include \u003cstdio.h\u003e\n  +\n  +int\n  +main(int argc, char\\* argv[])\n  +{\n-    printf(\"%.0f\", -0.0);\n-    return 0;\n  +}\n  \n  # Index: parrot-svn/config/gen/config_h/feature_h.in\n  \n  --- parrot-svn.orig/config/gen/config_h/feature_h.in    2008-12-06 00:10:10.000000000 +0000\n  +++ parrot-svn/config/gen/config_h/feature_h.in 2009-02-11 18:58:27.663375000 +0000\n  @@ -154,6 +154,15 @@\n  \n  print OUT \u003c\u003c'END_PRINT';\n\n+/\\* from config/auto/neg_0 */\n+END_PRINT\n+if (@has_negative_zero@) {\n-    print OUT \u003c\u003c'END_PRINT';\n  +#define PARROT_HAS_NEGATIVE_ZERO 1\n  +END_PRINT\n  +}\n  +\n  +print OUT \u003c\u003c'END_PRINT';\n  \n  #endif /\\* PARROT_FEATURE_H_GUARD */\n  END_PRINT\n  \n  # Index: parrot-svn/src/ops/io.ops\n  \n  --- parrot-svn.orig/src/ops/io.ops  2009-02-03 20:00:26.000000000 +0000\n  +++ parrot-svn/src/ops/io.ops   2009-02-11 19:10:47.085250000 +0000\n  @@ -152,7 +152,17 @@\n  }\n  \n  inline op print(in NUM) :base_io {\n  +#ifdef PARROT_HAS_NEGATIVE_ZERO\n  Parrot_io_printf(interp, FLOATVAL_FMT, $1);\n  +#else\n-  /\\* Workaround for older msvcrt and openbsd. TT #313 */\n-  if ($1 == -0.0) {\n-      Parrot_io_printf(interp, \"-0\");\n-  }\n-  else {\n-      Parrot_io_printf(interp, FLOATVAL_FMT, $1);\n-  }\n  +#endif\n  }\n  \n  op print(in STR) :base_io {\n  @@ -185,7 +195,17 @@\n  }\n  \n  inline op say(in NUM) :base_io {\n  +#ifdef PARROT_HAS_NEGATIVE_ZERO\n  Parrot_io_printf(interp, FLOATVAL_FMT \"\\n\", $1);\n  +#else\n-  /\\* Workaround for older msvcrt and openbsd. TT #313 */\n-  if ($1 == -0.0) {\n-      Parrot_io_printf(interp, \"-0\\n\");\n-  }\n-  else {\n-      Parrot_io_printf(interp, FLOATVAL_FMT \"\\n\", $1);\n-  }\n  +#endif\n  }\n  \n  op say(in STR) :base_io {\n\n```\n```","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234412825,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4Njc=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502867"},"message":"\u003cp\u003e\nAs discussed on irc the new feature has_negative_zero is checked in auto::neg_0 and used in io.ops for the -0.0 special case.\n\u003c/p\u003e\n\n\u003cp\u003e\nSee tt313-add-neg_0.patch\n\u003c/p\u003e\n\n\u003cp\u003e\nTested with has_negative_zero=1 on cygwin, debian-gcc and solaris-64-cc.\nBut on (has_negative_zero=0) mingw, msvc6 there's more work to be done.\n\u003c/p\u003e\n\n\u003cp\u003e\nLooks like x == -0.0 compare fails in this libc also.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234415197,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4Njg=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502868"},"message":"\u003cp\u003e\nSee \u003ca   href=\"http://gcc.gnu.org/ml/gcc/2007-06/msg00196.html\"\u003e\u003cspan class=\"icon\"\u003e \u003c/span\u003ehttp://gcc.gnu.org/ml/gcc/2007-06/msg00196.html\u003c/a\u003e\n\u003c/p\u003e\n\n\u003cp\u003e\nCurrent problem:\n\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\n0 == -0.0 =\u0026gt; 1 on mingw/msvc\n\u003c/p\u003e\n\u003c/blockquote\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1234416455,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4Njk=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502869"},"message":"\u003cp\u003e\nCorrect. You should find 0.0 == -0.0 on any reasonable compiler.  (Explicit testing on icc would be useful!)   If it's available, the best test to use is signbit().  This has come up many times before.  There is much more background in the RT tickets [RT \u003ca class=\"missing ticket\"\u003e#60312\u003c/a\u003e] (which includes a useful starting point for a patch)  [RT \u003ca class=\"missing ticket\"\u003e#28170\u003c/a\u003e] and [RT \u003ca class=\"missing ticket\"\u003e#30737\u003c/a\u003e] (incorrectly marked as rejected, but that's ok since it's duplicated by 60312).\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234496386,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzA=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502870"},"message":"\u003cp\u003e\nFixed by r36638.\n\u003c/p\u003e\n\n\u003cp\u003e\n- add has_negative_zero feature,\n- fix print_n and say_n for the platforms failing the new has_negative_zero\n\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\nconfigure test\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\n- enable the failing tests again\n\u003c/p\u003e\n\n\u003cp\u003e\nThis print -0.0 is a long-standing problem and finally fixes [perl \u003ca class=\"missing ticket\"\u003e#28170\u003c/a\u003e],\n[perl \u003ca class=\"missing ticket\"\u003e#30737\u003c/a\u003e], [perl \u003ca class=\"missing ticket\"\u003e#19183\u003c/a\u003e], [perl \u003ca class=\"missing ticket\"\u003e#60312\u003c/a\u003e].\n\u003c/p\u003e\n\n\u003cp\u003e\nNote that special yet untested platforms, like arm might also fail\nthe \"has_negative_zero\" test and might fail the signbit workaround we use.\nlong double -0.0 will also need a workaround code like this.\nThere's a patch to generate the signbit() fallback at RT \u003ca class=\"missing ticket\"\u003e#30737\u003c/a\u003e.\n\u003c/p\u003e\n\n\u003cp\u003e\nMany thanks to Andy Dougherty for pointing me to the old tickets\nand for the solution which was there for 5 years.\n\u003c/p\u003e\n\n\u003cp\u003e\nM    MANIFEST\nA    config/auto/neg_0.pm\nM    config/gen/config_h/feature_h.in\nM    lib/Parrot/Configure/Step/List.pm\nM    t/op/arithmetics.t\nM    t/pmc/complex.t\nM    t/pmc/float.t\nA    t/steps/auto_neg_0-01.t\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1234507529,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzE=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502871"},"message":"\u003cp\u003e\nI still don't see how this is \"fixed\".  I don't see any changes to print_n and say_n.  (Nor do I understand why you'd try to fix it there rather than in src/spf_render.c).  I see a new symbol PARROT_HAS_NEGATIVE_ZERO, but I don't see any code anywhere that does anything with it.\n\u003c/p\u003e\n\n\u003cp\u003e\nI am still confused.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234534415,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzI=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502872"},"message":"\u003cp\u003e\nOops, thanks. Added with r36660.\n\u003c/p\u003e\n\n\u003cp\u003e\nWhich cases are handled by spf_render,\nwhich are not handled in print_n and say_n?\nThese cases need to be added to the tests.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"3771fd696fba286f6d0b9544dc89da489f0c740e"},"timestamp":1234540104,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzM=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502873"},"message":"\u003cp\u003e\nIs It fixed by r36660? It still failed to me.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234547979,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzQ=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502874"},"message":"\u003cp\u003e\nAnother msvcrt.dll problem on another machine\nwith msvc6 only with r36632. mingw passes all tests there though.\n\u003c/p\u003e\n\n\u003cpre class=\"wiki\"\u003et\\op\\arithmetics....NOK 29#   Failed test 'Inf/NaN - basic arith'\n#   in t\\op\\arithmetics.t at line 846.\n#          got: 'Inf\n# -0\n# '\n#     expected: 'Inf\n# NaN\n# '\n# Looks like you failed 1 test of 29.\n\u003c/pre\u003e","files":null},{"type":3,"author":{"id":"86141a663c2eb7543d1a51ec6253a1d54de912fd"},"timestamp":1234577799,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzU=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502875"},"message":"\u003cp\u003e\nTodo the failing pmc tests with r36681.\n\u003c/p\u003e\n\n\u003cp\u003e\nNeed to check src/spf_render.c as they are failing there.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0cd3b02130a8b42e1ef2ea26b102fedb4bb839e4"},"timestamp":1246522199,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4NzY=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502876"},"message":"\u003cp\u003e\nIn r39864, I've just un-TODOed a test on openbsd (test \u003ca class=\"closed ticket\" href=\"http://trac.parrot.org/parrot/ticket/4\" title=\"todo: opcode deprecation review (closed: done)\"\u003e#4\u003c/a\u003e in t/op/arithmetics.t) which had a comment mentioning this ticket.  Apparently some floating point fixes to openbsd itself have improved the state of things for that particular test.\n\u003c/p\u003e\n\n\u003cp\u003e\nMark\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"0782f66a529ccd24e18226f5eebab20a90bea166"},"timestamp":1256720663,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4Nzc=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502877"},"message":"\u003cp\u003e\nRelated RT at \u003ca   href=\"http://rt.perl.org/rt3/Ticket/Display.html?id=37993\"\u003e\u003cspan class=\"icon\"\u003e \u003c/span\u003ehttp://rt.perl.org/rt3/Ticket/Display.html?id=37993\u003c/a\u003e (That ticket is closed in favor of this ticket.)\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"8c86ede03c8e80b0dad5131138f96e957a4ee66b"},"timestamp":1258427502,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDI4Nzg=","github-url":"https://github.com/parrot/parrot/issues/366#issuecomment-3502878"},"message":"\u003cp\u003e\nIn r42533, TODOed t/op/number.t test 131 (neg 0.0) where has_negative_zero is false.\n\u003c/p\u003e","files":null}]}