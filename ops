{"version":1,"ops":[{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1240059940,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM1NDA=","github-url":"https://github.com/parrot/parrot/issues/548#issuecomment-3503540"},"message":"3522 byte attachment from bsdz\nat http://trac.parrot.org/parrot/raw-attachment/ticket/562/test2.pir\n\n```.sub '' :main\n    say 'START'\n\n```\n.local pmc types, ops\ntypes = split ' ', 'Integer Float Complex'\nops = split ' ', 'add sub mul div'\n\n.local pmc i1\n.local string base_type, derived_type\ni1 = iter types\nnext_i1:\n    unless i1, end_i1 \n    base_type = shift i1\n    derived_type = concat 'Foo', base_type\n\n    $P0 = subclass base_type, derived_type\n\n    .local pmc i2, cs\n    .local string op  \n    i2 = iter ops\n    next_i2:\n        unless i2, end_i2\n        op = shift i2\n\n        cs = new 'CodeString'\n        cs.'emit'(\"print '%0: 10 %1 2 = '\", base_type, op)\n        cs.'emit'(\"$P0 = new '%0'\", base_type)\n        cs.'emit'(\"$P0 = 10\")\n        cs.'emit'(\"%0 $P1, $P0, 2\", op)\n        cs.'emit'(\"say $P1\")\n        eval(cs)\n\n        cs = new 'CodeString'\n        cs.'emit'(\"print '%0: 10 %1 2 = '\", derived_type, op)\n        cs.'emit'(\"$P0 = new '%0'\", derived_type)\n        cs.'emit'(\"$P0 = 10\")\n        cs.'emit'(\"%0 $P1, $P0, 2\", op)\n        cs.'emit'(\"say $P1\")\n        eval(cs)\n\n        goto next_i2\n    end_i2:\n\n    goto next_i1\nend_i1:\n\nsay 'FINISH'\n```\n\n.end\n\n.sub eval  \n    .param string code\n\n```\n.local pmc PIR\nPIR = compreg 'PIR'\n\n.local pmc eh\neh = new 'ExceptionHandler'\nset_addr eh, handler\npush_eh eh\n\n.local pmc cs\ncs = new ['CodeString']\ncs.'emit'(\".sub '' :anon\")\ncs.'emit'(code)\ncs.'emit'(\".end\")\n$P0 = PIR(cs)\n$P0()  \npop_eh\ngoto end\n\nhandler:\n    .local pmc ex\n    .local string msg\n    .get_results(ex)\n    msg = ex\n    say ex\n\nend:\n```\n\n.end\n\n=begin output\n\nSTART\nInteger: 10 add 2 = 12\nFooInteger: 10 add 2 = Multiple Dispatch: No suitable candidate found for 'add_int', with signature 'PIP-\u003eP'\nInteger: 10 sub 2 = 8\nFooInteger: 10 sub 2 = Multiple Dispatch: No suitable candidate found for 'subtract_int', with signature 'PIP-\u003eP'\nInteger: 10 mul 2 = 20\nFooInteger: 10 mul 2 = Multiple Dispatch: No suitable candidate found for 'multiply_int', with signature 'PIP-\u003eP'\nInteger: 10 div 2 = 5\nFooInteger: 10 div 2 = Multiple Dispatch: No suitable candidate found for 'divide_int', with signature 'PIP-\u003eP'\nFloat: 10 add 2 = 12\nFooFloat: 10 add 2 = Multiple Dispatch: No suitable candidate found for 'add_int', with signature 'PIP-\u003eP'\nFloat: 10 sub 2 = 8\nFooFloat: 10 sub 2 = Multiple Dispatch: No suitable candidate found for 'subtract_int', with signature 'PIP-\u003eP'\nFloat: 10 mul 2 = 20\nFooFloat: 10 mul 2 = Multiple Dispatch: No suitable candidate found for 'multiply_int', with signature 'PIP-\u003eP'\nFloat: 10 div 2 = 5\nFooFloat: 10 div 2 = Multiple Dispatch: No suitable candidate found for 'divide_int', with signature 'PIP-\u003eP'\nComplex: 10 add 2 = 12+0i\nFooComplex: 10 add 2 = Multiple Dispatch: No suitable candidate found for 'add_int', with signature 'PIP-\u003eP'\nComplex: 10 sub 2 = 8+0i\nFooComplex: 10 sub 2 = Multiple Dispatch: No suitable candidate found for 'subtract_int', with signature 'PIP-\u003eP'\nComplex: 10 mul 2 = 20+0i\nFooComplex: 10 mul 2 = Multiple Dispatch: No suitable candidate found for 'multiply_int', with signature 'PIP-\u003eP'\nComplex: 10 div 2 = 5+0i\nFooComplex: 10 div 2 = Multiple Dispatch: No suitable candidate found for 'divide_int', with signature 'PIP-\u003eP'\nFINISH\n\n=end output\n\n```\n```","files":null},{"type":3,"author":{"id":"6d59fc378929d99368e023bcfc49aacae1e68aad"},"timestamp":1240077940,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM1NDE=","github-url":"https://github.com/parrot/parrot/issues/548#issuecomment-3503541"},"message":"Trac commenter: bsdz\n\n```\n    \u003cp\u003e\n```\n\nPIR demonstrating the general case.\n\u003c/p\u003e","files":null},{"type":3,"author":{"id":"96fb2e2e33b59677e3a85ec74746c085275c50d1"},"timestamp":1259793408,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1MDM1NDI=","github-url":"https://github.com/parrot/parrot/issues/548#issuecomment-3503542"},"message":"\u003cp\u003e\nIt looks like this ticket still applies.\n\u003c/p\u003e\n\n\u003cp\u003e\nI was investigating a problem with t/pmc/complex.t and extracted the following test:\n\u003c/p\u003e\n\n\u003cpre class=\"wiki\"\u003e#! parrot\n.sub main :main\n    .include 'test_more.pir'\n    .include 'fp_equality.pasm'\n    .include \"iglobals.pasm\"\n    plan(3)\n    $P0 = subclass 'Complex', 'MyComplex'\n    addattribute $P0, \"re\"\n    addattribute $P0, \"im\"\n    .local pmc a, b, c\n    ##   a = 1 + 2i\n    a = new ['MyComplex']\n    a['real'] = 1\n    a['imag'] = 2\n    is( a, \"1+2i\", 'a created' )\n    ##   b = 3 + 4i\n    b = new ['MyComplex']\n    b['real'] = 3\n    b['imag'] = 4\n    is( b, \"3+4i\" , 'b created' )\n    ##   a = a + b\n    a = add a, b\n    is( a, \"4+6i\", 'subclass add' )\n.end\n\u003c/pre\u003e\u003cp\u003e\nwith the following results:\n\u003c/p\u003e\n\u003cpre class=\"wiki\"\u003emhb@mhb-desktop:~/parrot$ date\nWed Dec  2 13:09:06 GMT 2009\nmhb@mhb-desktop:~/parrot$ prove -v t/pmc/sub_comp.t\nt/pmc/sub_comp.t ..\n1..3\nok 1 - a created\nok 2 - b created\nnot ok 3 - subclass add\n\n# Have: 0+0i\n\n# Want: 4+6i\n\nFailed 1/3 subtests\n\n## Test Summary Report\n\nt/pmc/sub_comp.t (Wstat: 0 Tests: 3 Failed: 1)\n  Failed test:  3\nFiles=1, Tests=3,  0 wallclock secs ( 0.02 usr  0.00 sys +  0.01 cusr  0.02 csys =  0.05 CPU)\nResult: FAIL\n\u003c/pre\u003e\u003cp\u003e\nreturning 0+0i and not doing the add but overwriting the original value.\n\u003c/p\u003e","files":null}]}