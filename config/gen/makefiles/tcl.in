RM_F    = ${rm_f}
PERL    = ${perl}
PARROT  = .${slash}parrot${exe}
RELPATH = ..${slash}..${slash}
MYPATH  = languages${slash}tcl${slash}
LIBPATH  = $(MYPATH)lib${slash}

DEPS = $(RELPATH)$(PARROT) \
lib${slash}commands${slash}append.imc \
lib${slash}commands${slash}array.imc \
lib${slash}commands${slash}break.imc \
lib${slash}commands${slash}catch.imc \
lib${slash}commands${slash}concat.imc \
lib${slash}commands${slash}continue.imc \
lib${slash}commands${slash}error.imc \
lib${slash}commands${slash}eval.imc \
lib${slash}commands${slash}exit.imc \
lib${slash}commands${slash}expr.imc \
lib${slash}commands${slash}for.imc \
lib${slash}commands${slash}format.imc \
lib${slash}commands${slash}global.imc \
lib${slash}commands${slash}if.imc \
lib${slash}commands${slash}incr.imc \
lib${slash}commands${slash}join.imc \
lib${slash}commands${slash}lappend.imc \
lib${slash}commands${slash}linsert.imc \
lib${slash}commands${slash}list.imc \
lib${slash}commands${slash}llength.imc \
lib${slash}commands${slash}lrange.imc \
lib${slash}commands${slash}lrepeat.imc \
lib${slash}commands${slash}open.imc \
lib${slash}commands${slash}proc.imc \
lib${slash}commands${slash}puts.imc \
lib${slash}commands${slash}rename.imc \
lib${slash}commands${slash}return.imc \
lib${slash}commands${slash}set.imc \
lib${slash}commands${slash}source.imc \
lib${slash}commands${slash}string.imc \
lib${slash}commands${slash}time.imc \
lib${slash}commands${slash}unset.imc \
lib${slash}commands${slash}uplevel.imc \
lib${slash}commands${slash}upvar.imc \
lib${slash}commands${slash}while.imc \
lib${slash}expression.imc \
lib${slash}get_var.imc \
lib${slash}interpret.imc \
lib${slash}list.imc \
lib${slash}macros${slash}boolean.imc \
lib${slash}macros${slash}is_space.imc \
lib${slash}macros${slash}match_close.imc \
lib${slash}parse.imc \
lib${slash}string_to_list.imc \
tcl.imc_template \
tcl.pl

tcl.pbc: lib${slash}tcllib.pbc lib${slash}tclword.pbc tcl.imc
	(cd $(RELPATH) && $(PARROT) --output=$(MYPATH)tcl.pbc $(MYPATH)tcl.imc)

lib${slash}tcllib.imc: $(DEPS)
	$(PERL) tcl.pl > lib${slash}tcllib.imc

lib${slash}tcllib.pbc: lib${slash}tcllib.imc
	(cd $(RELPATH) && $(PARROT) --output=$(LIBPATH)tcllib.pbc $(LIBPATH)tcllib.imc)

lib${slash}tclword.pbc: lib${slash}tclword.imc
	(cd $(RELPATH) && $(PARROT) --output=$(LIBPATH)tclword.pbc $(LIBPATH)tclword.imc)

test:	tcl.pbc
	cd t && $(PERL) -MTest::Harness -e 'runtests(glob("*.t"))' && cd ..

devtest:
	cd t && $(PERL) -e 'use Test::Harness qw($$verbose runtests) ; $$Test::Harness::verbose=1;runtests(glob("*.t"))' && cd ..

clean:
	$(RM_F) lib${slash}tcllib.imc tcl.pbc lib${slash}*.pbc

distclean: clean
	$(RM_F) Makefile

